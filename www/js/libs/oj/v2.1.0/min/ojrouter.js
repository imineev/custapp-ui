/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","knockout","signals","promise"],function(b,f,a){(function(){function d(){var a=window.location.href.split("#")[0];return a.substring(0,a.lastIndexOf("/"))}function c(a){var b={},d=[],c,e;if(a)for(c in d=a.split("\x26"),d)e=d[c].split(/\=(.+)?/),a=e[0],a.length&&(b[a]||(b[a]=[]),e=e[1]&&decodeURIComponent(e[1].replace(/\+/g," ")),b[a].push(e));return b}function e(a,d){var c;d&&a.Vq&&(b.l.Ho(d),a.Vq.every(function(a){return a.kl===d?(c=a,!1):!0}));return c}function g(){return window.location.href.split("#")[0].replace(F+
"/","")}function h(a){return a.wo?h(a.wo)+"."+a.lf:a.lf}function k(a){return a?k(a.wo)+a.vF().kl+"/":"/"}function l(a,b){var d;a.Gh.every(function(a){return a.xo&&a.xo!==b?!0:(d=a,!1)});return d}function p(){return L[0]&&L[0].cancel}function n(a){var d=a.charAt(0);a=a.slice(1);if("0"===d)a=decodeURIComponent(a);else if("1"===d)a=b.mX.qya(a);else throw Error("Error retrieving bookmarkable data. Format is invalid");return JSON.parse(a)}function m(a,d){if(d&&0<Object.getOwnPropertyNames(d).length){var c;
c=-1===a.indexOf("?")?"?":"\x26";var e=a,f=JSON.stringify(d),g=encodeURIComponent(f),f=b.mX.Sxa(f),h=!1,k="oj_Router\x3d";f.length<=g.length&&(h=!0);k=h?k+("1"+f):k+("0"+g);if(1024<k.length)throw Error("Size of bookmarkable data is too big.");a=e+(c+k)}return a}function q(a,b,d){var c;a.Gh.every(function(a){return a.xo&&a.xo!==d||!a.Wl(b)?!0:(c=a,!1)});return c}function s(a,b){var d=[],c=[],e=a,f=b.split("/"),g,h,k;for(f.splice(0,1);e;)c.unshift(e),e=e.wo;for(;g=f.shift();){e=c.shift();if(!e){if(e=
q(h,g,k),!e){I=b;break}}else if(!e.Wl(g))throw Error('Invalid path "'+b+'". State id "'+g+'" does not exist on router "'+e.lf+'".');d.push({yd:e,uy:g});h=e;k=g}e=!0;for(c=d.length-1;0<=c&&e;c--)d[c].uy===d[c].yd.Am?d[c].uy=null:e=!1;return d}function r(a,d){var c=!0,e=Promise.resolve(!0),f=a.vF(),g,h;if(f){for(g=0;g<a.Gh.length;g++)if(c=r(a.Gh[g],d),!c)return!1;g=f.wK&&f.wK.canExit?f.wK.canExit:f.Sz;if("function"===typeof g){try{h=g()}catch(k){return b.r.error("Error when executing canExit callback: %s",
k.message),!1}h&&h.then?e=h:(h||b.r.info("canExit is false for state %s",f.kl),c=h)}}d.push(e);return c}function u(a){var d;if(!a)return Promise.resolve(!p());d=[];return r(a,d)?Promise.all(d).then(function(a){var d;for(d=0;d<a.length;d++)if(!a[d])return b.r.info("CanExit promise at position %s returned false.",String(d)),!1;return!p()}):Promise.resolve(!1)}function v(a,d){b.r.info("Start _canEnter.");var c=!0,e=Promise.resolve(!0),f=[];a.every(function(a){var d,g;if(d=a.yd.Wl(a.value))if(a=d.Rz,
"function"===typeof a){try{g=a()}catch(h){return b.r.error("Error when executing canEnter callback: %s",h.message),c=!1}if(g&&g.then)e=g;else if(c=g,!c)return b.r.info("canEnter is false for state: %s",d.kl),!1}f.push(e);return!0});return!c||p()?Promise.resolve({DI:[]}):Promise.all(f).then(function(c){var e;for(e=0;e<c.length;e++)if(!c[e])return b.r.info("CanEnter promise at position %s returned false.",String(e)),{DI:[]};return{DI:a,origin:d}})}function w(a,d){var c=a.yd.Wl(a.yd.Xg()),e=a.value?
a.yd.Wl(a.value):void 0;return Promise.resolve().then(function(){b.r.info("Updating state of %s to %s.",h(a.yd),a.value)}).then(c?c.jA:void 0).then(function(){var b=a.yd,c,e,f;if("popState"===d){e=b.Ww.length;for(c=e-1;0<=c;c--)if(b.Ww[c]===a.value){f=!0;b.Ww.splice(c,e-c);break}1===e-c&&(b.hB="back")}f||(delete b.hB,b.Ww.push(b.Xg()));b.Xg(a.value)}).then(e?e.iA:void 0)}function t(a){var d;d=Promise.resolve().then(function(){b.r.info("Entering _updateAll.");b.ub.tI=!0});a.DI.forEach(function(b){d=
d.then(function(){if(!p())return w(b,a.origin)})});return d.then(function(){var d=0<a.DI.length&&!p();b.ub.tI=!1;b.r.info("_updateAll returns %s.",String(d));return{hasChanged:d}},function(a){b.ub.tI=!1;return Promise.reject(a)})}function x(a){var d={},c,e=a.split("?")[1]||"";b.r.info("Parsing: %s",a);a=A.kC(a);if(e=e.split("oj_Router\x3d")[1])e=e.split("\x26")[0],d=n(e);if(b.r.option("level")===b.r.iv)for(c in b.r.info("Bookmarkable data: "),d)b.r.info("   { router: %s, value: %s }",c,d[c]);a=A.parse(a).filter(function(a){var b=
d[a.yd.lf];b&&(a.yd.fl=b);return a.value!==a.yd.Xg()});b.r.option("level")===b.r.iv&&(b.r.info("Potential changes are: "),a.forEach(function(a){b.r.info("   { router: %s, value: %s }",h(a.yd),a.value)}));return a}function y(a,b){var d;try{d=x(a)}catch(c){return Promise.reject(c)}return v(d,b).then(t)}function B(a){b.r.info("\x3e\x3e Executing: path\x3d%s, url\x3d%s, origin\x3d%s",a.path,a.url,a.origin);return void 0!==a.url?"sync"===a.origin?y(a.url):u(a.yd).then(function(b){return b?y(a.url,a.origin):
{hasChanged:!1}}):a.yd.xoa(a.path||null,a.replace)}function C(){var a=L[0];b.r.info("\x3e\x3e Resolving: path\x3d%s, url\x3d%s",a.path,a.url);a.cancel?(b.r.info("\x3e\x3e Cancelled: path\x3d%s, url\x3d%s",a.path,a.url),a=Promise.resolve({hasChanged:!1})):a=B(a);return a.then(function(a){var d=L.shift();b.r.info("\x3e\x3e Done with: path\x3d%s, url\x3d%s",d.path,d.url);b.ub.tx.dispatch(a);return a},function(a){L=[];b.ub.tx.dispatch({hasChanged:!1});return Promise.reject(a)})}function M(a){var d;d=
L.push(a);b.r.info("\x3e\x3e Queue transition for path\x3d%s, url\x3d%s",a.path,a.url);1===d?D=C():(a=L[d-2],a.url||a.sya||(b.r.info("\x3e\x3e Cancelling: path\x3d%s",a.path),a.cancel=!0),D=D.then(C));return D}function G(){var a,d,c=null;b.r.info("Handling popState event with URL: %s",window.location.href);for(a=0;a<J.Gh.length;a++)if(d=J.Gh[a],J.Xg()&&J.Xg()===d.xo){c=d;break}M({yd:c,url:g(),origin:"popState"}).then(null,function(a){b.r.error("Error while changing state in handlePopState: %s",a.message)})}
function E(){H||(A||(A=new b.ub.BW),F||(F=d()),window.addEventListener("popstate",G,!1),b.r.info("Initializing rootInstance."),b.r.info("Base URL is %s",F),b.r.info("This page is %s",z),b.r.info("Current URL is %s",window.location.href),H=!0)}var F,z=function(){var a="",b=window.location.pathname;-1!==b.indexOf(".html",b.length-5)&&(a=b.split("/").pop());return a}(),A,H=!1,I,L=[],D;b.ub=function(a,b){var d=this;this.lf=a;this.xo=b?b.Xg():void 0;this.wo=b;this.Gh=[];this.fl=void 0;this.Xg=f.observable();
this.Vva=f.pureComputed({read:function(){return this.Xg()},write:function(a){this.go(a).then(null,function(a){throw a;})},owner:d});this.Vq=null;this.Am=void 0;this.vF=f.pureComputed(function(){return f.ignoreDependencies(d.Wl,d,[d.Xg()])});this.vla=f.pureComputed(function(){var a,b=f.ignoreDependencies(d.Wl,d,[d.Xg()]);b&&(a=b.value);return a});this.hB=void 0;this.Ww=[];this.asa=Object.create(null,{name:{value:f.pureComputed(function(){var a,b;b=this.Xg()||this.Am||this.Vq[0];if(b=this.Wl(b))a=b.value,
a&&"string"===typeof a||(a=b.kl);return a},d),enumerable:!0},params:{value:Object.create(null,{ojRouter:{value:new function(){Object.defineProperties(this,{parentRouter:{value:d,enumerable:!0},direction:{get:function(){return d.hB},enumerable:!0}})},enumerable:!0}}),enumerable:!0},lifecycleListener:{value:Object.create(null,{attached:{value:function(a){var b=a.valueAccessor().params.ojRouter.parentRouter.vF();b&&(b.wK=a.viewModel)}}}),enumerable:!0}});Object.defineProperties(this,{parent:{value:this.wo,
enumerable:!0}})};o_("Router",b.ub,b);Object.defineProperties(b.ub.prototype,{name:{get:function(){return this.lf},enumerable:!0},states:{get:function(){return this.Vq},enumerable:!0},stateId:{get:function(){return this.Vva},enumerable:!0},currentState:{get:function(){return this.vF},enumerable:!0},currentValue:{get:function(){return this.vla},enumerable:!0},defaultStateId:{get:function(){return this.Am},set:function(a){this.Am=a},enumerable:!0},moduleConfig:{get:function(){return this.asa},enumerable:!0}});
var J=new b.ub("root",void 0);b.ub.prototype.$$=function(a){var b;a&&"string"===typeof a&&(a=a.trim(),0<a.length&&this.Gh.every(function(d){return d.lf===a?(b=d,!1):!0}));return b};b.b.g("Router.prototype.getChildRouter",{$$:b.ub.prototype.$$});b.ub.prototype.u$=function(a){var d,c;b.l.Ho(a);a=encodeURIComponent(a.trim());for(d=0;d<this.Gh.length;d++){c=this.Gh[d];if(c.lf===a)throw Error('Invalid router name "'+a+'", it already exists.');if(c.xo===this.Xg())throw Error('Cannot create more than one child router for parent state id "'+
c.xo+'".');}a=new b.ub(a,this);this.Gh.push(a);return a};b.b.g("Router.prototype.createChildRouter",{u$:b.ub.prototype.u$});b.ub.prototype.Wl=function(a){return e(this,a)};b.ub.prototype.p$=function(a){this.Xg(void 0);delete this.Am;this.hB=void 0;this.Ww=[];"function"===typeof a?(this.Vq=null,this.Wl=a):(this.Vq=[],delete this.Wl,Object.keys(a).forEach(function(d){var c=a[d];this.Vq.push(new b.ov(d,c,this));"boolean"===typeof c.isDefault&&c.isDefault&&(this.Am=d)},this));return this};b.b.g("Router.prototype.configure",
{p$:b.ub.prototype.p$});b.ub.prototype.Oaa=function(a){return this.Wl(a)};b.b.g("Router.prototype.getState",{Oaa:b.ub.prototype.Oaa});b.ub.prototype.go=function(a){E();return M({yd:this,path:a,origin:"go"})};b.b.g("Router.prototype.go",{go:b.ub.prototype.go});b.ub.prototype.xoa=function(a,d){function c(a){return a?y(f.replace(/^\//,"")).then(function(a){if(a.hasChanged){var c=F+f;b.r.info("%s URL to %s",d?"Replacing":"Pushing",c);window.history[d?"replaceState":"pushState"](null,"",c)}return a}):
{hasChanged:!1}}var e,f,r;e=!0;if(a)if("string"===typeof a)0<a.length&&(e=!1);else return Promise.reject(Error("Invalid object type for state id."));if(e&&(a=this.Am||null,!a))return b.r.option("level")===b.r.iv&&b.r.info("Undefined state id with no default id on router %s",h(this)),Promise.resolve({hasChanged:!1});e="/"===a.charAt(0)?a:k(this.wo)+a;b.r.info("Destination path: %s",e);try{r=s(this,e)}catch(l){return Promise.reject(l)}f=A.d$(r);b.r.option("level")===b.r.iv&&b.r.info("Going to URL %s on router %s",
f,h(this));r="/"+A.kC(g()).replace(z,"");return A.kC(f)!==r?(b.r.info("New URL is different."),u(this).then(c)):Promise.resolve({hasChanged:!1})};b.ub.prototype.Nda=function(a){this.fl=a;a={};for(var b=this;b;)b.fl&&(a[b.lf]=b.fl),b=b.wo;for(var b=this,d,c,e;b;){for(c=0;c<b.Gh.length;c++)if(e=b.Gh[c],b.Xg()&&b.Xg()===e.xo){e.fl&&(a[e.lf]=e.fl);d=e;break}b=d;d=void 0}d=F+"/"+A.kC(g());d=m(d,a);window.history.replaceState(null,"",d)};b.b.g("Router.prototype.store",{Nda:b.ub.prototype.Nda});b.ub.prototype.pda=
function(){return this.fl};b.b.g("Router.prototype.retrieve",{pda:b.ub.prototype.pda});b.ub.prototype.Ix=function(){for(var a,d;0<this.Gh.length;)this.Gh[0].Ix();if(this.wo){a=this.wo.Gh;for(d=0;d<a.length;d++)if(a[d].lf===this.lf){a.splice(d,1);break}delete this.xo}else F="",A={},this.lf="root",window.removeEventListener("popstate",G),b.ub.tx.removeAll(),H=!1;delete this.hB;this.Ww=[];this.Vq=null;delete this.Am;delete this.fl};b.b.g("Router.prototype.dispose",{Ix:b.ub.prototype.Ix});b.ub.tx=new a.Signal;
b.ub.tI=!1;Object.defineProperties(b.ub,{rootInstance:{value:J,enumerable:!0},transitionedToState:{value:b.ub.tx,enumerable:!0}});b.ub.td={};o_("Router.defaults",b.ub.td,b);Object.defineProperties(b.ub.td,{urlAdapter:{get:function(){A||(A=new b.ub.BW);return A},set:function(a){if(H)throw Error("Incorrect operation. Cannot change URL adapter after calling sync() or go().");A=a},enumerable:!0,hK:!1},baseUrl:{get:function(){F||(F=d());return F},set:function(a){if(H)throw Error("Incorrect operation. Cannot change base URL after calling sync() or go().");
F=a.replace(/\/$/,"")},enumerable:!0,hK:!1},rootInstanceName:{get:function(){return J.lf},set:function(a){if(H)throw Error("Incorrect operation. Cannot change the name of the root instance after calling sync() or go().");b.l.Ho(a);J.lf=encodeURIComponent(a.trim())},enumerable:!0,hK:!1}});b.ub.sW=function(){var a;E();b.r.info("Entering sync.");if(I)return a={yd:J,path:I,sya:!0,replace:!0},I=void 0,M(a);if(b.ub.tI)return b.r.info("Sync called while updating, waiting for updates to end."),new Promise(function(a){b.ub.tx.addOnce(function(d){b.r.info("Sync updates done.");
a(d)})});a={yd:J,url:g(),origin:"sync"};return M(a)};o_("Router.sync",b.ub.sW,b);b.ub.BW=function(){this.parse=function(a){var b=J;a=a.split("/");var d=[],c;do(c=a.shift())&&(0===c.length||/\.html$/i.test(c))&&(c=void 0),c=c||b.Am,d.push({value:c,yd:b}),b=l(b,c);while(b);return d};this.d$=function(a){var d="",c={};a.forEach(function(a){a.uy&&(d+="/"+a.uy);a.yd.aEa&&(c[a.yd.lf]=a.yd.fl)});""===d&&(d="/"+z);try{d=m(d,c)}catch(e){b.r.error("Error while building URL: %s",e)}return d};this.kC=function(a){return a.split("?")[0]};
this.zaa=function(a){var b=a.indexOf("?"),d=null;-1!==b&&(d=a.substr(b+1));return c(d)}};o_("Router.urlPathAdapter",b.ub.BW,b);b.ub.ACa=function(){this.parse=function(a){a=this.zaa(a);var b=J,d=[],c;do{if(c=a[b.lf])c=c[0],delete a[b.lf];c=c||b.Am;d.push({value:c,yd:b});b=l(b,c)}while(b);return d};this.d$=function(a){var d="/"+z,c={},e="?";a.forEach(function(a){a.uy&&(d+=e+a.yd.lf+"\x3d"+a.uy,e="\x26");a.yd.fl&&(c[a.yd.lf]=a.yd.fl)});try{d=m(d,c)}catch(f){b.r.error("Error while building URL: %s",f)}return d};
this.kC=function(a){var b=a.indexOf("oj_Router\x3d");return-1!==b?a.substr(0,b-1):a};this.zaa=function(a){var b=a.indexOf("?"),d=null,d={};-1!==b&&(d=a.substr(b+1),d=c(d));return d}};o_("Router.urlParamAdapter",b.ub.ACa,b);return J})();(function(){b.ov=function(a,c,e){c=c||{};b.l.Ho(a);this.kl=encodeURIComponent(a.trim());(this.Rz=c.canEnter)&&b.l.Ax(this.Rz);(this.iA=c.enter)&&b.l.Ax(this.iA);(this.Sz=c.canExit)&&b.l.Ax(this.Sz);(this.jA=c.exit)&&b.l.Ax(this.jA);this.J9=c.value;this.F5=c.label;this.IH=
e;this.wK=void 0;Object.defineProperties(this,{id:{value:this.kl,enumerable:!0},value:{get:function(){return this.J9},set:function(a){this.J9=a},enumerable:!0},label:{get:function(){return this.F5},set:function(a){this.F5=a},enumerable:!0},canEnter:{get:function(){return this.Rz},set:function(a){this.Rz=a},enumerable:!0},enter:{get:function(){return this.iA},set:function(a){this.iA=a},enumerable:!0},canExit:{get:function(){return this.Sz},set:function(a){this.Sz=a},enumerable:!0},exit:{get:function(){return this.jA},
set:function(a){this.jA=a},enumerable:!0}})};o_("RouterState",b.ov,b);b.ov.prototype.go=function(){return this.IH?this.IH.go(this.kl):(b.ub.tx.dispatch({hasChanged:!1}),Promise.reject(Error("Router is not defined for this RouterState object.")))};b.b.g("RouterState.prototype.go",{go:b.ov.prototype.go});b.ov.prototype.Lba=function(){if(!this.IH)throw Error("Router is not defined for this RouterState object.");return this.IH.Xg()===this.kl};b.b.g("RouterState.prototype.isCurrent",{Lba:b.ov.prototype.Lba})})();
(function(){function a(b,d){if(null===b)return"";var c,e,f={},g={},h="",r=2,u=3,v=2,w="",t=0,x=0,y,B,C,M=b.length;for(C=0;C<M;C++)if(y=b[C],Object.prototype.hasOwnProperty.call(f,y)||(f[y]=u++,g[y]=!0),B=h+y,Object.prototype.hasOwnProperty.call(f,B))h=B;else{if(Object.prototype.hasOwnProperty.call(g,h)){if(256>h.charCodeAt(0)){for(c=v;c--;)t<<=1,5==x?(x=0,w+=d(t),t=0):x++;e=h.charCodeAt(0);c=8}else{e=1;for(c=v;c--;)t=t<<1|e,5==x?(x=0,w+=d(t),t=0):x++,e=0;e=h.charCodeAt(0);c=16}for(;c--;)t=t<<1|e&
1,5==x?(x=0,w+=d(t),t=0):x++,e>>=1;r--;0==r&&(r=Math.pow(2,v),v++);delete g[h]}else for(e=f[h],c=v;c--;)t=t<<1|e&1,5==x?(x=0,w+=d(t),t=0):x++,e>>=1;r--;0==r&&(r=Math.pow(2,v),v++);f[B]=u++;h=String(y)}if(""!==h){if(Object.prototype.hasOwnProperty.call(g,h)){if(256>h.charCodeAt(0)){for(c=v;c--;)t<<=1,5==x?(x=0,w+=d(t),t=0):x++;e=h.charCodeAt(0);c=8}else{e=1;for(c=v;c--;)t=t<<1|e,5==x?(x=0,w+=d(t),t=0):x++,e=0;e=h.charCodeAt(0);c=16}for(;c--;)t=t<<1|e&1,5==x?(x=0,w+=d(t),t=0):x++,e>>=1;r--;0==r&&(r=
Math.pow(2,v),v++);delete g[h]}else for(e=f[h],c=v;c--;)t=t<<1|e&1,5==x?(x=0,w+=d(t),t=0):x++,e>>=1;r--;0==r&&v++}e=2;for(c=v;c--;)t=t<<1|e&1,5==x?(x=0,w+=d(t),t=0):x++,e>>=1;for(;;)if(t<<=1,5==x){w+=d(t);break}else x++;return w}function c(a,b){for(var d=[],c=4,f=4,g=3,h="",r="",u,v,w,t,x,y={val:b(0),position:32,index:1},r=0;3>r;r+=1)d[r]=r;h=0;w=Math.pow(2,2);for(t=1;t!=w;)v=y.val&y.position,y.position>>=1,0==y.position&&(y.position=32,y.val=b(y.index++)),h|=(0<v?1:0)*t,t<<=1;switch(h){case 0:h=
0;w=Math.pow(2,8);for(t=1;t!=w;)v=y.val&y.position,y.position>>=1,0==y.position&&(y.position=32,y.val=b(y.index++)),h|=(0<v?1:0)*t,t<<=1;x=e(h);break;case 1:h=0;w=Math.pow(2,16);for(t=1;t!=w;)v=y.val&y.position,y.position>>=1,0==y.position&&(y.position=32,y.val=b(y.index++)),h|=(0<v?1:0)*t,t<<=1;x=e(h);break;case 2:return""}for(u=r=d[3]=x;;){if(y.index>a)return"";h=0;w=Math.pow(2,g);for(t=1;t!=w;)v=y.val&y.position,y.position>>=1,0==y.position&&(y.position=32,y.val=b(y.index++)),h|=(0<v?1:0)*t,t<<=
1;switch(x=h){case 0:h=0;w=Math.pow(2,8);for(t=1;t!=w;)v=y.val&y.position,y.position>>=1,0==y.position&&(y.position=32,y.val=b(y.index++)),h|=(0<v?1:0)*t,t<<=1;d[f++]=e(h);x=f-1;c--;break;case 1:h=0;w=Math.pow(2,16);for(t=1;t!=w;)v=y.val&y.position,y.position>>=1,0==y.position&&(y.position=32,y.val=b(y.index++)),h|=(0<v?1:0)*t,t<<=1;d[f++]=e(h);x=f-1;c--;break;case 2:return r}0==c&&(c=Math.pow(2,g),g++);if(d[x])h=d[x];else if(x===f)h=u+u[0];else return null;r+=h;d[f++]=u+h[0];c--;u=h;0==c&&(c=Math.pow(2,
g),g++)}}b.mX={Sxa:function(b){return null===b?"":a(b,function(a){return f.charAt(a)})},qya:function(a){return null===a?"":""===a?null:c(a.length,function(b){var d=f;b=a.charAt(b);var c;h||(h={});if(!h[d])for(h[d]={},c=0;c<d.length;c++)h[d][d[c]]=c;return h[d][b]})}};var e=String.fromCharCode,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",h})()});