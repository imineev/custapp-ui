/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery"],function(b,f){b.vh=function(a,b,c){c=c||{};this.i=b;this.HF=a;this.kw=c.fetchSize;this.kw=0<this.kw?this.kw:25;this.Uw=c.maxCount;this.Uw=0<this.Uw?this.Uw:500;this.JH=0;this.X8=c.success;this.jma=c.error;this.It();f(this.HF).on("scroll.domscroller",function(a){var b=f(a.target).scrollTop();a=f(a.target)[0].scrollHeight-f(a.target)[0].clientHeight;0<a&&this.qQ(b,a)}.bind(this))};b.vh.prototype.destroy=function(){this.Rm();f(this.HF).off("scroll.domscroller")};b.b.g("DomScroller.prototype.destroy",
{destroy:b.vh.prototype.destroy});b.vh.prototype.checkViewport=function(){return 0<this.HF[0].clientHeight&&!this.Sja()?this.Q1():Promise.resolve(null)};b.b.g("DomScroller.prototype.checkViewport",{checkViewport:b.vh.prototype.checkViewport});b.vh.prototype.qQ=function(a,b){if(1>=b-a){var c=this;this.Q1().then(function(a){null!=c.X8&&c.X8(a)},this.jma)}};b.vh.prototype.Sja=function(){var a=this.HF;return a[0].scrollHeight>a[0].clientHeight+1?!0:!1};b.vh.prototype.Q1=function(){if(this.MF)return this.MF;
var a=this.Uw-this.JH;if(0<a){var b=this.kw,c=this;a<this.kw&&(b=a);var e=this.uma({pageSize:b});return this.MF=new Promise(function(b){e.then(function(d){c.MF=null;null!=d&&(c.JH=d.data.length+d.startIndex,a<c.kw&&(d.maxCount=c.Uw,d.maxCountLimit=!0));b(d)})})}return Promise.resolve({maxCount:this.Uw,maxCountLimit:!0})};b.vh.prototype.uma=function(a){a=a||{};var b=a.pageSize;this.hj=this.hj?this.hj+b:b;if(-1==this.i.totalSize()||this.i.totalSize()>this.hj){var c=this;return new Promise(function(a,
f){c.i.fetch({startIndex:c.hj,pageSize:b}).then(function(b){a(b)},function(){f(null)})})}return Promise.resolve()};b.vh.prototype.Aq=function(){this.hj=null;this.JH=0};b.vh.prototype.Toa=function(a){this.hj=a.startIndex;this.JH=a.data.length+this.hj};b.vh.prototype.It=function(){var a=this.i;if(null!=a){this.Rm();this.pb=[];this.pb.push({eventType:b.V.N.SORT,eventHandler:this.Aq.bind(this)});this.pb.push({eventType:b.V.N.REFRESH,eventHandler:this.Aq.bind(this)});this.pb.push({eventType:b.V.N.RESET,
eventHandler:this.Aq.bind(this)});this.pb.push({eventType:b.V.N.SYNC,eventHandler:this.Toa.bind(this)});var d,c;for(d=0;d<this.pb.length;d++)(c=a.on(this.pb[d].eventType,this.pb[d].eventHandler))&&(this.pb[d].eventHandler=c)}};b.vh.prototype.Rm=function(){var a=this.i;if(null!=this.pb&&null!=a){var b;for(b=0;b<this.pb.length;b++)a.off(this.pb[b].eventType,this.pb[b].eventHandler)}}});