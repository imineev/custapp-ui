/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","knockout","promise"],function(b,f){b.jv={};b.jv.td={viewPath:"text!views/",viewSuffix:".html",modelPath:"viewModels/",initializeMethod:"initialize",disposeMethod:"dispose",activatedHandler:"handleActivated",attachedHandler:"handleAttached",detachedHandler:"handleDetached",bindingsAppliedHandler:"handleBindingsApplied",deactivatedHandler:"handleDeactivated",transitionCompletedHandler:"handleTransitionCompleted"};o_("ModuleBinding.defaults",b.jv.td,b);(function(){function a(a,
d,e,g,h,k,l){var m=d.canAnimate;if(null==m||m.call(d,a)){var n,q;if(m=d.prepareAnimation.call(d,a))n=m.newViewParent,q=m.oldViewParent;var s=n||e;q&&q!==e?c(g,q):s===e&&k(null);s!==e&&f.virtualElements.setDomNodeChildren(s,[]);h(s);var E=Array.prototype.slice.call(s.childNodes),F=!1,z=function(){F||(F=!0,e!==s&&p(e,E))},A=k.bind(null,q);a.newViewParent=n;a.oldViewParent=q;a.oldViewNodes=g;a.removeOldView=A;a.insertNewView=z;var H=function(){A();z();l()};return d.animate.call(d,a).then(H,function(){H();
b.r.error("ojModule animation promise was rejected")})}}function d(a,b,c){b=b||a;var d=[];c&&a===b&&(c.parentNode.removeChild(c),d.push(c));f.virtualElements.setDomNodeChildren(b,d)}function c(a,b){a.forEach(function(a){b.appendChild(a)})}function e(a,b,c){if(a&&a[b]){var d={element:c[0],valueAccessor:c[1]};2<c.length&&(d.viewModel=c[2],3<c.length&&(d["boolean"===typeof c[3]?"fromCache":"cachedNodes"]=c[3]));return f.ignoreDependencies(a[b],a,[d])}}function g(a,c,d){if(null!=a&&(c=b.jv.td[c],null!=
c&&a&&(c=a[c],"function"===typeof c))){var e=void 0;d&&(e={element:d[0],valueAccessor:d[1]},2<d.length&&(e["boolean"===typeof d[2]?"fromCache":"cachedNodes"]=d[2]));return f.ignoreDependencies(c,a,[e])}}function h(a,b,c){var d=[];for(a=f.virtualElements.firstChild(a);null!=a&&a!=c;a=a.nextSibling)a!=b&&d.push(a);return d}function k(a,b){var c=[],d=f.virtualElements.firstChild(a);l(d,b,function(a){c.push(a)});return c}function l(a,b,c){for(;null!=a;){var d=f.virtualElements.nextSibling(a),e=a.nodeType;
a===b||1!==e&&8!==e||c(a);a=d}}function p(a,b){for(var c=b.length-1;0<=c;c--)f.virtualElements.prepend(a,b[c])}function n(a,c){if(null!=b.Components)for(var d=0;d<a.length;d++)c?b.Components.xp(a[d]):b.Components.Rr(a[d])}function m(a){if("string"===typeof a)a=f.utils.parseHtmlFragment(a);else if(window.DocumentFragment?a instanceof DocumentFragment:a&&11===a.nodeType)a=f.utils.arrayPushAll([],a.childNodes);else if(Array.isArray(a))a=f.utils.arrayPushAll([],a);else throw"The View ("+a+") has an unsupported type";
return a}function q(a){return new Promise(function(b){require([a],function(a){b(a)},function(){throw Error("ojModule failed to load "+a);})})}function s(a){return a?new Promise(function(b){a.then(b,b)}):a}f.bindingHandlers.ojModule={init:function(r,u,v,w,t){function x(a){if(a!=E)throw Error("Promise cancelled because ojModule is fetching new View and ViewModel");}function y(a){g(a,"disposeMethod",[r,u])}var B,C,M={},G,E=-1,F,z;f.utils.domNodeDisposal.addDisposeCallback(r,function(){y(B);for(var a=
Object.keys(M),b=0;b<a.length;b++)y(M[a[b]].Hr)});8===r.nodeType&&(f.virtualElements.setDomNodeChildren(r,[]),z=r.nextSibling);f.computed(function(){E++;var v=0===E,w=f.utils.unwrapObservable,I=w(u()),L,D,J,N,K,Q,O,U;"string"===typeof I?L=I:(L=w(I.name),D=w(I.viewName),J=w(I.params),N=w(I.viewModelFactory),K=w(I.createViewFunction),Q=w(I.cacheKey),O=w(I.lifecycleListener),U=w(I.animation));var w=e(O,"activated",[r,u]),P,W,Z=null==Q?null:M[Q];if(null!=Z)delete M[Q],P=Promise.resolve(Z.view),W=Promise.resolve(Z.Hr);
else if(null!=N&&(W=f.ignoreDependencies(N.createViewModel,N,[J,u])),null==W&&null!=L&&(W=q(b.jv.td.modelPath+L)),null!=W&&(W=W.then(function(a,b){x(a);return b="function"===typeof b?new b(J):g(b,"initializeMethod",[r,u])||b}.bind(null,E)),null!=K&&(P=W.then(function(a,b){x(a);if(null==b)throw"createViewFunction option cannot be used when the ViewModel is null";var c=b[K];if(null==c)throw"function specified by the createViewFunction option was not found on the ViewModel";return c.call(b)}.bind(null,
E)))),null==P)if(D=null==D?L:D,null!=D)P=q(b.jv.td.viewPath+D+b.jv.td.viewSuffix);else throw Error("View name must be specified");if(null==P)throw Error("ojModule is missing a View");var X;null!=W&&(X=W.then(function(a,b){x(a);return g(b,"activatedHandler",[r,u])}.bind(null,E)));Promise.all([P,W,w,X,C]).then(function(b,q){if(b==E){var w=q[0];if(null==w)throw"The module's View was resolved to null";var x=m(w),H=q[1],I=!1,D,L=h(r,F,z),K=k(r,F);null!=G&&(I=!0,D=L,F||(F=document.createElement("div"),
F.className="oj-helper-module-cache",f.virtualElements.prepend(r,F)));var N=!1,w=function(a){N||(N=!0,I?c(L,F):K.forEach(function(a){f.cleanNode(a)}),d(r,a||r,F),v||(e(O,"detached",[r,u,B,D]),g(B,"detachedHandler",[r,u,D]),e(O,"deactivated",[r,u,B]),g(B,"deactivatedHandler",[r,u])),I?(n(D,!1),M[G]={Hr:B,view:D}):y(B),B=H,G=Q)},P=function(a){a=a||r;p(a,x);var b=null!=Z;b&&n(x,!0);e(O,"attached",[a,u,H,b]);g(H,"attachedHandler",[a,u,b]);if(!b){var c=t.createChildContext(H,void 0,function(a){a.$module=
H;a.$params=J});l(x[0],F,function(a){f.applyBindings(c,a)});e(O,"bindingsApplied",[a,u,H]);g(H,"bindingsAppliedHandler",[a,u])}},ga=function(){e(O,"transitionCompleted",[r,u,H]);g(H,"transitionCompletedHandler",[r,u])};if(null!=U){var ja=a({node:r,valueAccessor:u,isInitial:v,oldViewModel:B,newViewModel:H},U,r,L,P,w,ga);C=s(ja)}else C=void 0;C||(w(null),P(null),ga())}}.bind(null,E),function(a,c){a==E&&null!=c&&b.r.error(c)}.bind(null,E))},null,{disposeWhenNodeIsRemoved:r});return{controlsDescendantBindings:!0}}};
f.virtualElements.allowedBindings.ojModule=!0})()});