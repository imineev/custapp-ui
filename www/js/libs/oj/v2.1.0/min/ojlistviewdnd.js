/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","ojdnd","ojs/ojlistview"],function(b,f){b.Wa=function(a){this.Aa=a};o_("ListViewDndContext",b.Wa,b);b.b.la(b.Wa,b.b,"oj.ListViewDndContext");b.Wa.xea=67;b.Wa.zL=86;b.Wa.BL=88;b.Wa.prototype.XO=function(a){var b=this.Aa.Pd("dnd");return null!=b&&b[a]?b[a].items:null};b.Wa.prototype.gG=function(){return this.XO("drag")};b.Wa.prototype.YO=function(){return this.XO("drop")};b.Wa.prototype.to=function(){return"enabled"==this.XO("reorder")};b.Wa.prototype.gf=function(a){return this.Aa.Ok(a)};
b.Wa.prototype.DP=function(){var a,b,c,e;a=[];if(this.Aa.Tb())for(b=this.Aa.Pd("selection"),c=0;c<b.length;c++)e=this.Aa.re(b[c]),null==e||this.Aa.$i(f(e))||a.push(e);else e=this.JO(),null!=e&&a.push(e);null!=this.qu&&0<this.qu.length&&-1==a.indexOf(this.qu.get(0))&&a.push(this.qu.get(0));return a};b.Wa.prototype.JO=function(){return null==this.Aa.J?null:this.Aa.J.elem[0]};b.Wa.prototype.ou=function(a){var b;f(a).hasClass(this.Aa.Li())||(a=a.firstElementChild);a=f(a).find(".oj-listview-drag-handle");
null!=a&&0<a.length&&(b=a.attr("aria-labelledby"),null==b?a.attr("aria-labelledby",this.Aa.Ss("instr")):a.attr("aria-labelledby",b+" "+this.Aa.Ss("instr")),this.Aa.ek()&&a.attr("draggable","true"))};b.Wa.prototype.g8=function(a){var b,c;if(null!=this.gG()||this.to()){if(a.hasClass("oj-listview-drag-handle"))b=f(a);else{a=this.gf(a);if(null!=a){c=a.find(".oj-listview-drag-handle");if(null!=c&&0<c.length)return;a.addClass("oj-draggable")}c=this.JO();null!=c&&(null!=a&&0==a.find(".oj-listview-drag-handle").length&&
a[0]==c?b=a:f(c).removeClass("oj-draggable"))}null!=b&&b.attr("draggable",!0)}};b.Wa.prototype.z9=function(a){if(null!=this.gG()||this.to())a=a.hasClass("oj-listview-drag-handle")?f(a):this.gf(a),null!=a&&a.removeAttr("draggable")};b.Wa.prototype.ll=function(a,d,c,e){var f;if(a="drag"===a?this.gG():this.YO())if((d=a[d])&&"function"==typeof d)try{c.dataTransfer=c.originalEvent.dataTransfer,f=d(c,e)}catch(h){b.r.error("Error: "+h)}else return-1;return f};b.Wa.prototype.Sua=function(a,b,c){var e,f=[],
h;for(e=0;e<c.length;e++)(h=this.Aa.z2(c[e]))&&(h.innerHTML&&h.tagName&&"LI"==h.tagName?f.push(h.innerHTML):f.push(h));return 0<f.length?(this.Rua(a.originalEvent,b,f),this.Tua(a.originalEvent,c),{items:f}):null};b.Wa.prototype.Rua=function(a,b,c){var e;a=a.dataTransfer;c=JSON.stringify(c);if("string"==typeof b)a.setData(b,c);else if(b)for(e=0;e<b.length;e++)a.setData(b[e],c);a.setData("text/ojlistview-dragsource-id",this.Aa.element.get(0).id)};b.Wa.prototype.Tua=function(a,b){var c,e,g=Number.MAX_VALUE,
h,k,l,p=0,n=0;c=a.target;if(1<b.length){c=f(document.createElement("ul"));c.get(0).className=this.Aa.element.get(0).className;c.addClass("oj-listview-drag-image").css({width:this.Aa.element.css("width"),height:this.Aa.element.css("height")});for(e=0;e<b.length;e++)g=Math.min(g,b[e].offsetTop);for(e=0;e<b.length;e++)h=b[e].offsetTop-g,k=b[e].offsetWidth,l=f(b[e].cloneNode(!0)),l.removeClass("oj-selected oj-focus oj-hover").css({position:"absolute",top:h,width:k}),c.append(l)}else f(c).hasClass("oj-listview-drag-handle")&&
(p=Math.max(0,c.offsetLeft-b[0].offsetLeft)+c.offsetWidth/2,n=c.offsetTop+c.offsetHeight/2),l=f(b[0].cloneNode(!0)),l.removeClass("oj-selected oj-focus oj-hover").addClass("oj-drag"),c=f(document.createElement("ul")),c.get(0).className=this.Aa.element.get(0).className,c.addClass("oj-listview-drag-image").css({width:this.Aa.element.css("width"),height:2*b[0].offsetHeight}).append(l);f("body").append(c);this.FJ=c;a.dataTransfer.setDragImage(c.get(0),p,n)};b.Wa.prototype.fQ=function(a){var b,c,e;b=this.gG();
if(null!=b||this.to())if(c=null!=b?b.dataTypes:"text/ojlistview-items-data",f(a.target).hasClass("oj-listview-drag-handle")?(e=[],e.push(this.gf(a.target)[0])):e=this.DP(),0<e.length){if(null==b&&1<e.length)return!1;this.dp=e;this.DJ=f(e[0]);if(b=this.Sua(a,c,e)){if(a=this.ll("drag","dragStart",a,b),-1!==a)return a}else return!1}};b.Wa.prototype.Woa=function(a){return this.ll("drag","drag",a)};b.Wa.prototype.zF=function(){null!=this.FJ&&(this.FJ.remove(),this.FJ=null)};b.Wa.prototype.bQ=function(a){var b;
if(null!=this.DJ&&null!=this.dp)for(this.DJ.find(".oj-listview-drag-handle").removeAttr("draggable"),this.DJ.removeClass("oj-drag oj-draggable").removeAttr("draggable"),b=0;b<this.dp.length;b++)f(this.dp[b]).css("display","block");this.Uz();this.zF();this.ll("drag","dragEnd",a);this.DJ=this.FJ=null};b.Wa.prototype.kR=function(a){var b,c;b=this.YO();if(this.to()&&null==b)return!0;if(b&&b.dataTypes)for(b=b.dataTypes,b="string"==typeof b?[b]:b,a=a.originalEvent.dataTransfer.types,c=0;c<a.length;c++)if(0<=
b.indexOf(a[c]))return!0;return!1};b.Wa.prototype.ml=function(a,b,c){a=this.ll("drop",a,b,c);(void 0===a||-1===a)&&this.kR(b)&&b.preventDefault();return a};b.Wa.prototype.F0=function(a){var b;null==this.Zh&&(b=f(a.get(0).cloneNode(!1)),b.addClass("oj-drop").removeClass("oj-drag oj-draggable oj-hover oj-focus oj-selected").css({display:"block",height:a.outerHeight()}),this.Zh=b);return this.Zh};b.Wa.prototype.h0=function(){null!=this.Ll&&-1===this.gy&&this.Ll.children("."+this.Aa.vf()).removeClass("oj-drop")};
b.Wa.prototype.Uz=function(){null!=this.Zh&&(this.Zh.css("height","0"),this.Zh.remove(),this.Zh=null);this.h0()};b.Wa.prototype.cQ=function(a){var b;b=this.gf(a.target);a=this.ml("dragEnter",a,{item:b.get(0)});if(-1!=a)return a};b.Wa.prototype.d8=function(a){null!=this.Ll&&this.Ll.removeClass("oj-valid-drop oj-invalid-drop");this.Ll=a;this.Ll.addClass("oj-valid-drop")};b.Wa.prototype.X7=function(a,b){var c;c=a.attr("aria-label");null==c&&(c=a.text());c=this.Aa.W.v("accessibleReorder"+b.charAt(0).toUpperCase()+
b.substr(1)+"Item",{item:c});this.Aa.Wg(c)};b.Wa.prototype.Kia=function(){null==this.ica&&this.Aa.ek()&&(this.Aa.element.find("ul."+this.Aa.eh()).each(function(){f(this).attr("oldMaxHeight",f(this).css("maxHeight").toString());f(this).css("maxHeight",1E4)}),this.ica="adjusted")};b.Wa.prototype.G7=function(){this.Aa.ek()&&this.Aa.element.find("ul."+this.Aa.eh()).each(function(){f(this).css("maxHeight",parseInt(f(this).attr("oldMaxHeight"),10));f(this).removeAttr("oldMaxHeight")});this.ica=null};b.Wa.prototype.eQ=
function(a){var b,c,e,g;if(null!=this.YO()||this.to()){this.Kia();if(null!=this.dp&&"none"!=f(this.dp[0]).css("display")){b=f(this.dp[0]);c=this.F0(b);for(a=0;a<this.dp.length;a++)f(this.dp[a]).css("display","none");c.insertBefore(b);this.gy=c.index()}else b=this.gf(a.target),null!=b&&0<b.length&&(e=this.ml("dragOver",a,{item:b.get(0)}),-1===e&&this.to()||!1===e||a.isDefaultPrevented()?(b.hasClass(this.Aa.Li())?(this.h0(),b.hasClass("oj-drop")||(c=this.F0(b),g=b.index(),null==this.gy||this.gy<g?(c.insertAfter(b),
this.fy="after"):(c.insertBefore(b),this.fy="before"),this.X7(b,this.fy),this.d8(b),this.gy=c.index())):(this.Uz(),b.children("."+this.Aa.vf()).addClass("oj-drop"),this.d8(b),this.gy=-1,this.fy="inside",this.X7(b,this.fy)),a.preventDefault()):f(a.target).hasClass(this.Aa.eh())||(b.addClass("oj-invalid-drop"),this.Uz()));return e}};b.Wa.prototype.SQ=function(a,b){var c,e;c=b.getBoundingClientRect();e=a.originalEvent;return e.clientX>=c.left&&e.clientX<c.right&&e.clientY>=c.top&&e.clientY<c.bottom};
b.Wa.prototype.dQ=function(a){var b,c;if(null!=this.Ll&&(b=this.gf(a.target),null!=b&&0<b.length&&(b.removeClass("oj-valid-drop oj-invalid-drop"),c=this.ml("dragLeave",a,{item:b.get(0)}),this.SQ(a,a.currentTarget)||(this.Uz(),this.G7())),-1!=c))return c};b.Wa.prototype.gQ=function(a){var b,c;if(null!=this.Ll&&(b=a.originalEvent.dataTransfer.getData("text/ojlistview-dragsource-id"),c={item:this.Ll.get(0),position:this.fy},this.to()&&b===this.Aa.element.get(0).id?c.reorder=!0:c.reorder=!1,b=this.ml("drop",
a,c),c.reorder&&(c.items=this.dp,c.reference=c.item,this.Aa.aj("reorder",a,c),a.preventDefault()),null!=this.Ll&&this.Ll.removeClass("oj-valid-drop"),this.Uz(),this.G7(),this.zF(),this.Ll=null,this.gy=-1,this.fy=null,-1!==b))return b};b.Wa.prototype.fxa=function(a){var b=this,c,e;this.to()&&(void 0==a&&(a=this.Aa.Pd("contextMenu")),null!=a&&(null==this.Bk&&(this.Bk=[]),a=f(a),c=a.find("[data-oj-command]"),e=[],c.each(function(){var a,c;0===f(this).children("a").length?0==f(this).attr("data-oj-command").indexOf("oj-listview-")&&
(a=f(this).attr("data-oj-command").substring(12),c=b.si(a),c.get(0).className=f(this).get(0).className,f(this).replaceWith(c)):(a=f(this).attr("data-oj-command"),"pasteBefore"==a?a="paste-before":"pasteAfter"==a&&(a="paste-after"));null!=a&&e.push(a)}),this.Bk=e,0<e.length&&(a.data("oj-ojMenu")&&a.ojMenu("refresh"),a.on("ojselect",this.kj.bind(this)))))};b.Wa.prototype.si=function(a){return"paste-before"===a?this.ef("pasteBefore"):"paste-after"===a?this.ef("pasteAfter"):this.ef(a)};b.Wa.prototype.ef=
function(a){var b=f("\x3cli\x3e\x3c/li\x3e");b.attr("data-oj-command",a);b.append(this.Pz(a));return b};b.Wa.prototype.Pz=function(a){a="label"+a.charAt(0).toUpperCase()+a.slice(1);return f('\x3ca href\x3d"#"\x3e\x3c/a\x3e').text(this.Aa.W.v(a))};b.Wa.prototype.EA=function(a){var b;null!=this.Kl&&f(this.Kl).removeClass("oj-listview-cut");b=this.DP();f(b).addClass("oj-listview-cut");this.Kl=b;this.Aa.aj("cut",a,{items:b})};b.Wa.prototype.S3=function(a){var b;null!=this.Kl&&f(this.Kl).removeClass("oj-listview-cut");
this.Kl=b=this.DP();this.Aa.aj("copy",a,{items:b})};b.Wa.prototype.GA=function(a,b,c){this.Aa.aj("paste",a,{item:b.get(0)});f(this.Kl).removeClass("oj-listview-cut");this.Aa.aj("reorder",a,{items:this.Kl,position:c,reference:b.get(0)});this.Kl=null};b.Wa.prototype.kj=function(a,b){if(null!=this.qu)switch(b.item.attr("data-oj-command")){case "cut":this.EA(a);break;case "copy":this.S3(a);break;case "paste":var c=!0;case "pasteBefore":var e=!0;case "pasteAfter":var f="after";c?f="inside":e&&(f="before");
this.GA(a,this.qu,f);this.qu=null}};b.Wa.prototype.Hz=function(a,b){null!=this.Bk&&("paste-before"==b?b="pasteBefore":"paste-after"==b&&(b="pasteAfter"),a.find("[data-oj-command\x3d'"+b+"']").removeClass("oj-disabled"))};b.Wa.prototype.Ooa=function(a,b){var c;a.find("[data-oj-command]").addClass("oj-disabled");c=this.gf(b.originalEvent.target);null==c||null==this.Bk||0==this.Bk.length?a.ojMenu("refresh"):(c.children().first().hasClass(this.Aa.vf())?null!=this.Kl&&this.Hz(a,"paste"):(this.Hz(a,"cut"),
this.Hz(a,"copy"),null!=this.Kl&&(this.Hz(a,"paste-before"),this.Hz(a,"paste-after"))),a.ojMenu("refresh"),this.qu=c)};b.Wa.prototype.JD=function(a){var d,c;if(!this.to()||null==this.Bk||0==this.Bk.length)return!1;if(a.ctrlKey||a.metaKey){d=a.keyCode;if(d===b.Wa.BL&&-1<this.Bk.indexOf("cut"))return this.EA(a),!0;if(d===b.Wa.xea&&-1<this.Bk.indexOf("copy"))return this.S3(a),!0;if(d===b.Wa.zL&&null!=this.Kl&&(d=f(this.JO()),d.children().first().hasClass(this.Aa.vf())?-1<this.Bk.indexOf("paste")&&(c=
"inside"):-1<this.Bk.indexOf("paste-before")?c="before":-1<this.Bk.indexOf("paste-after")&&(c="after"),null!=c))return this.GA(a,d,c),!0}return!1}});