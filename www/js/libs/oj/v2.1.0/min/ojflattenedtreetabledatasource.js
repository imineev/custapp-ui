/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","ojs/ojdatasource-common"],function(b){b.Cb=function(f,a){a=a||{};if(!(f instanceof b.ia))throw Error(b.V.Kc._ERR_DATA_INVALID_TYPE_SUMMARY+"\n"+b.V.Kc._ERR_DATA_INVALID_TYPE_DETAIL);this.i=f;this.ie=[];this.fa=0;this.Mq=[];null==this.i.wC("fetchSize")&&(this.i.Il=function(){return-1});var d=this;this.i.sJ=function(a,e,f){var h,k,l,p=[],n=[],m=[];for(e=0;e<f.getCount();e++)h=f.getData(e),l=f.getMetadata(e).key,k=a+e,d.Mq[k]={},d.Mq[k].nodeSet=f,d.Mq[k].startIndex=a,p.push(h),
n.push(l),m.push(k),d.ua.data.splice(k,0,h),d.ua.keys.splice(k,0,l),d.ua.indexes.splice(k,0,k);d.cb||b.V.p.handleEvent.call(d,b.V.N.ADD,{data:p,keys:n,indexes:m});d.xB();d.cb&&setTimeout(function(){d.i.refresh();d.ua=null;d.fetch()},0)};this.i.lK=function(a){var e,f,h=[],k=[],l=[];for(e=0;e<a.length;e++)f=a[e].index-e,h.push(""),k.push(""),l.push(f),d.ua.data.splice(f,1),d.ua.keys.splice(f,1),d.ua.indexes.splice(f,1);d.cb||b.V.p.handleEvent.call(d,b.V.N.REMOVE,{data:h,keys:k,indexes:l});d.xB();d.cb&&
setTimeout(function(){d.i.refresh();d.ua=null;d.fetch()},0)};this.Init();if(null!=a&&("enabled"==a.startFetch||null==a.startFetch)||null==a)this.PB=!0};o_("FlattenedTreeTableDataSource",b.Cb,b);b.b.la(b.Cb,b.V,"oj.FlattenedTreeTableDataSource");b.Cb.prototype.Init=function(){b.Cb.p.Init.call(this)};b.b.g("FlattenedTreeTableDataSource.prototype.Init",{Init:b.Cb.prototype.Init});b.Cb.prototype.getCapability=function(){return"full"};b.b.g("FlattenedTreeTableDataSource.prototype.getCapability",{getCapability:b.Cb.prototype.getCapability});
b.Cb.prototype.getWrappedDataSource=function(){return this.i};b.b.g("FlattenedTreeTableDataSource.prototype.getWrappedDataSource",{getWrappedDataSource:b.Cb.prototype.getWrappedDataSource});b.Cb.prototype.fetch=function(b){b=b||{};return"init"!=b.fetchType||this.PB?this.Lf(b):Promise.resolve()};b.b.g("FlattenedTreeTableDataSource.prototype.fetch",{fetch:b.Cb.prototype.fetch});b.Cb.prototype.at=function(b){var a;a=0>b||b>=this.ua.length?null:{data:this.ua.data[b],index:b,key:this.ua.keys[b]};return new Promise(function(b){b(a)})};
b.b.g("FlattenedTreeTableDataSource.prototype.at",{at:b.Cb.prototype.at});b.Cb.prototype.collapse=function(b){this.i.collapse(b)};b.b.g("FlattenedTreeTableDataSource.prototype.collapse",{collapse:b.Cb.prototype.collapse});b.Cb.prototype.expand=function(b){this.i.expand(b)};b.b.g("FlattenedTreeTableDataSource.prototype.expand",{expand:b.Cb.prototype.expand});b.Cb.prototype.get=function(){b.l.Dc();return null};b.b.g("FlattenedTreeTableDataSource.prototype.get",{get:b.Cb.prototype.get});b.Cb.prototype.on=
function(f,a){if("expand"==f||"collapse"==f)this.i.on(f,a);else b.Cb.p.on.call(this,f,a)};b.b.g("FlattenedTreeTableDataSource.prototype.on",{on:b.Cb.prototype.on});b.Cb.prototype.off=function(f,a){"expand"==f||"collapse"==f?this.i.off(f,a):b.Cb.p.off.call(this,f,a)};b.b.g("FlattenedTreeTableDataSource.prototype.off",{off:b.Cb.prototype.off});b.Cb.prototype.sort=function(f){if(null==f)return Promise.resolve();var a=this;f.axis="column";return new Promise(function(d,c){a.i.getWrappedDataSource().sort(f,
{success:function(){setTimeout(function(){a.i.refresh();a.ua=null;var c={header:f.key,direction:f.direction};b.V.p.handleEvent.call(a,b.V.N.SORT,c);d(c)},0)}.bind(this),error:function(a){c(a)}.bind(this)})})};b.b.g("FlattenedTreeTableDataSource.prototype.sort",{sort:b.Cb.prototype.sort});b.Cb.prototype.totalSize=function(){return-1};b.b.g("FlattenedTreeTableDataSource.prototype.totalSize",{totalSize:b.Cb.prototype.totalSize});b.Cb.prototype.totalSizeConfidence=function(){return"unknown"};b.b.g("FlattenedTreeTableDataSource.prototype.totalSizeConfidence",
{totalSizeConfidence:b.Cb.prototype.totalSizeConfidence});b.Cb.prototype.xA=function(b){return this.Mq[b].nodeSet.getMetadata(b-this.Mq[b].startIndex)};b.Cb.prototype.Lf=function(f){f=f||{};this.OB(f);this.fa=null==f.startIndex?this.fa:f.startIndex;var a=Number.MAX_VALUE;this.cb=null==f.pageSize?this.cb:f.pageSize;null!=this.cb&&(a=this.cb);var d=this.fa;if(null!=this.ua)if(null!=this.cb){var c=this.ua.data.length-1;if(this.fa+this.cb-1<=c){var c=b.Cb.iG(this.ua,this.fa,this.cb),a=[],e=[],g;for(g=
this.fa;g<=c;g++)a[g-this.fa]=this.ua.data[g],e[g-this.fa]=this.xA(g).key;c={data:a,keys:e,startIndex:this.fa};this.dl(f,c,null);return Promise.resolve(c)}this.fa<=c&&(d=c+1)}else this.i.refresh(),this.ua=null;else d=0;var h={start:d,count:a},k=this;return new Promise(function(a,c){k.i.cn(h,{success:function(c){k.hQ(c,d);f.refresh=!0;c=b.Cb.iG(k.ua,k.fa,k.cb);var e=[],g=[],h;for(h=k.fa;h<=c;h++)e[h-k.fa]=k.ua.data[h],g[h-k.fa]=k.xA(h).key;c={data:e,keys:g,startIndex:k.fa};k.dl(f,c,null);a(c)}.bind(this),
error:function(a){k.dl(f,null,a);c(a)}.bind(this)})})};b.Cb.prototype.hQ=function(f,a){var d,c;for(d=0;d<f.getCount();d++)c=a+d,this.Mq[c]={},this.Mq[c].nodeSet=f,this.Mq[c].startIndex=a;this.ua||(this.ua={},this.ua.data=[],this.ua.keys=[],this.ua.indexes=[]);b.Cb.zw(f,this,this.ua)};b.Cb.prototype.OB=function(f){f.silent||b.V.p.handleEvent.call(this,b.V.N.REQUEST,{startIndex:f.startIndex})};b.Cb.prototype.dl=function(f,a,d){null!=d?b.V.p.handleEvent.call(this,b.V.N.ERROR,d):f.silent||b.V.p.handleEvent.call(this,
b.V.N.SYNC,a)};b.Cb.iG=function(b,a,d){var c=b.data.length-1;0<d&&(c=a+d-1,c=c>b.data.length-1?b.data.length-1:c);return c};b.Cb.zw=function(b,a,d){a=b.getCount()-1;var c;for(c=b.getStart();c<=a;c++){var e=b.getData(c);d.data[c]=e;d.keys[c]="";d.indexes[c]=c}};b.Cb.prototype.xB=function(){for(var b=0;b<this.ua.data.length;b++)this.ua.indexes[b]=b}});