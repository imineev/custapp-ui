/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojdatasource-common","ojs/ojrowexpander"],function(b){b.yg=function(f,a,d,c,e){b.l.hC(d);this.Gc=f;this.zf=a;this.KJ=d;this.$b=c;this.Da=e};o_("FlattenedTreeHeaderSet",b.yg,b);b.yg.prototype.getData=function(f,a){var d;b.l.assert(f<=this.zf&&f>=this.Gc,"index out of bounds");b.l.assert(null==a||0==a,"level out of bounds");return null!=this.Da&&null!=this.$b?(d=this.$b.getData(f-this.Gc+this.$b.getStart()),null!=d?d.get?d.get(this.Da):d[this.Da]:null):this.KJ[f]};
b.b.g("FlattenedTreeHeaderSet.prototype.getData",{getData:b.yg.prototype.getData});b.yg.prototype.getMetadata=function(f,a){b.l.assert(f<=this.zf&&f>=this.Gc,"index out of bounds");b.l.assert(null==a||0==a,"level out of bounds");return null!=this.Da&&null!=this.$b?this.$b.getMetadata(f-this.Gc+this.$b.getStart()):{key:this.getData(f)}};b.b.g("FlattenedTreeHeaderSet.prototype.getMetadata",{getMetadata:b.yg.prototype.getMetadata});b.yg.prototype.getCount=function(){return null!=this.Da&&null!=this.$b?
Math.min(this.$b.getCount(),this.zf-this.Gc):Math.max(0,this.zf-this.Gc)};b.b.g("FlattenedTreeHeaderSet.prototype.getCount",{getCount:b.yg.prototype.getCount});b.yg.prototype.getLevelCount=function(){return 0<this.getCount()?1:0};b.b.g("FlattenedTreeHeaderSet.prototype.getLevelCount",{getLevelCount:b.yg.prototype.getLevelCount});b.yg.prototype.getExtent=function(f,a){b.l.assert(f<=this.zf&&f>=this.Gc,"index out of bounds");b.l.assert(null==a||0==a,"level out of bounds");return{extent:1,more:{before:!1,
after:!1}}};b.b.g("FlattenedTreeHeaderSet.prototype.getExtent",{getExtent:b.yg.prototype.getExtent});b.yg.prototype.getDepth=function(f,a){b.l.assert(f<=this.zf&&f>=this.Gc,"index out of bounds");b.l.assert(null==a||0==a,"level out of bounds");return 1};b.b.g("FlattenedTreeHeaderSet.prototype.getDepth",{getDepth:b.yg.prototype.getDepth});b.Fj=function(f,a,d,c,e,g){b.l.hC(g);this.sa=f;this.Ya=a;this.xn=d;this.vu=c;this.$b=e;this.We=g};o_("FlattenedTreeCellSet",b.Fj,b);b.Fj.prototype.getData=function(f){var a;
a=this.o3(f);if(null==a)return null;f=a[0];a=a[1];b.l.assert(f<this.$b.getStart()+this.$b.getCount()&&a<this.We.length);a=this.We[a];f=this.$b.getData(f);return null!=f?f.get?f.get(a):f[a]:null};b.b.g("FlattenedTreeCellSet.prototype.getData",{getData:b.Fj.prototype.getData});b.Fj.prototype.getMetadata=function(f){var a;a=this.o3(f);if(null==a)return null;f=a[0];a=a[1];b.l.assert(f<this.$b.getStart()+this.$b.getCount()&&a<this.We.length);a=this.We[a];f=this.$b.getMetadata(f);f.keys={row:f.key,column:a};
return f};b.b.g("FlattenedTreeCellSet.prototype.getMetadata",{getMetadata:b.Fj.prototype.getMetadata});b.Fj.prototype.o3=function(f){var a;b.l.Zg(f);if(null==this.$b||0==this.$b.length)return null;a=f.row-this.sa+this.$b.getStart();f=f.column;b.l.Go(a,null);b.l.Go(f,null);b.l.assert(0<=a&&0<=f);return[a,f]};b.Fj.prototype.getStart=function(b){return"row"===b?this.sa:"column"===b?this.xn:0};b.b.g("FlattenedTreeCellSet.prototype.getStart",{getStart:b.Fj.prototype.getStart});b.Fj.prototype.getCount=
function(b){return"row"===b?Math.min(this.Ya-this.sa,this.$b.getCount()):"column"===b?this.vu-this.xn:0};b.b.g("FlattenedTreeCellSet.prototype.getCount",{getCount:b.Fj.prototype.getCount});b.fb=function(f,a){b.fb.p.constructor.call(this,f,a)};o_("FlattenedTreeDataGridDataSource",b.fb,b);b.b.la(b.fb,b.ia,"oj.FlattenedTreeDataGridDataSource");b.fb.prototype.Init=function(){b.fb.p.Init.call(this);this.We=b.fb.p.wC.call(this,"columns");this.Da=b.fb.p.wC.call(this,"rowHeader")};b.b.g("FlattenedTreeDataGridDataSource.prototype.Init",
{Init:b.fb.prototype.Init});b.fb.prototype.getCountPrecision=function(b){return"row"===b?"estimate":"actual"};b.b.g("FlattenedTreeDataGridDataSource.prototype.getCountPrecision",{getCountPrecision:b.fb.prototype.getCountPrecision});b.fb.prototype.getCount=function(b){return"row"===b?-1:"column"===b?this.We.length:0};b.b.g("FlattenedTreeDataGridDataSource.prototype.getCount",{getCount:b.fb.prototype.getCount});b.fb.prototype.fetchHeaders=function(f,a,d){var c,e;c=f.axis;if("column"===c)c=f.start+f.count,
c>this.getCount("column")&&(c=this.getCount("column")-f.start),e=new b.yg(f.start,c,this.We);else if("row"===c){if(null!=this.Da){this.tn={range:f,callbacks:a,callbackObjects:d};return}e=new b.Ke(f.start,f.start,c,null)}null!=e&&null!=a&&null!=a.success&&(null==d&&(d={}),a.success.call(d.success,e,f))};b.b.g("FlattenedTreeDataGridDataSource.prototype.fetchHeaders",{fetchHeaders:b.fb.prototype.fetchHeaders});b.fb.prototype.fetchCells=function(f,a,d){var c,e,g,h;for(c=0;c<f.length;c++)if(e=f[c],"row"==
e.axis){g=e.start;h=e.count;break}b.fb.p.cn.call(this,{start:g,count:h},{success:function(b){this.hQ(b,f,a,d,0)}.bind(this),error:function(b){this.bpa(b,{start:g,count:h},a,d)}.bind(this)})};b.b.g("FlattenedTreeDataGridDataSource.prototype.fetchCells",{fetchCells:b.fb.prototype.fetchCells});b.fb.prototype.keys=function(f){var a,d;a=f.row;d=f.column;return new Promise(function(c){a>b.fb.p.Vya.call(this).end||d>this.We.length?c(null):c({row:b.fb.p.getKey.call(this,a),column:this.We[d]})}.bind(this))};
b.b.g("FlattenedTreeDataGridDataSource.prototype.keys",{keys:b.fb.prototype.keys});b.fb.prototype.indexes=function(f){var a,d,c,e,g;c=f.row;e=f.column;return new Promise(function(f){a=b.fb.p.tk.call(this,c);for(g=0;g<this.We.length;g++)if(this.We[g]===e){d=g;break}0<=a||0<=d?f({row:a,column:d}):f(null)}.bind(this))};b.b.g("FlattenedTreeDataGridDataSource.prototype.indexes",{indexes:b.fb.prototype.indexes});b.fb.prototype.sort=function(f,a,d){return b.fb.p.getWrappedDataSource.call(this).sort(f,{success:function(){this.tQ(a,
d)}.bind(this),error:a.error})};b.b.g("FlattenedTreeDataGridDataSource.prototype.sort",{sort:b.fb.prototype.sort});b.fb.prototype.tQ=function(b,a){this.refresh();b.success&&(null==a&&(a={}),b.success.call(a.success))};b.fb.prototype.move=function(f,a,d,c){b.fb.p.getWrappedDataSource.call(this).move(f,a,d,c)};b.b.g("FlattenedTreeDataGridDataSource.prototype.move",{move:b.fb.prototype.move});b.fb.prototype.getCapability=function(f){return"default"===b.fb.p.getWrappedDataSource.call(this).getCapability(f)?
"column":"none"};b.b.g("FlattenedTreeDataGridDataSource.prototype.getCapability",{getCapability:b.fb.prototype.getCapability});b.fb.prototype.GC=function(f,a){b.fb.p.GC.call(this,f,a)};b.fb.prototype.hQ=function(f,a,d,c){var e,g,h,k,l,p;for(e=0;e<a.length;e++)g=a[e],"row"==g.axis?(h=g.start,k=g.count):"column"==g.axis&&(l=g.start,p=g.count,l+p>this.getCount("column")&&(p=this.getCount("column")-l));this.tn&&(e=this.tn.range,e.start==h&&e.count==k&&this.oQ(f,e,this.tn.callbacks,this.tn.callbackObjects),
this.tn=null);f=new b.Fj(h,h+k,l,l+p,f,this.We);d.success&&(null==c&&(c={}),d.success.call(c.success,f,a))};b.fb.prototype.bpa=function(b,a,d,c){var e;this.tn&&(e=this.tn.range,e.start==a.start&&e.count==a.count&&(a=this.tn.callbacks,e=this.tn.callbackObjects,a.error&&(null==e&&(e={}),a.error.call(e.error,b))),this.tn=null);d.error&&(null==c&&(c={}),d.success.call(c.error,b))};b.fb.prototype.oQ=function(f,a,d,c){f=new b.yg(a.start,a.start+a.count,this.We,f,this.Da);d.success&&(null==c&&(c={}),d.success.call(c.success,
f,a))};b.fb.prototype.sJ=function(f,a,d){var c,e,g,h;c=null;this.Da&&(c=new b.yg(f,f+d.getCount(),this.We,d,this.Da));a=new b.Fj(f,f+d.getCount(),0,this.We.length,d,this.We);g=[];h=[];for(e=0;e<d.getCount();e++)g.push({row:this.wi(f+e).key}),h.push({row:f+e,column:-1});f={source:this,operation:"insert"};f.result=a;c&&(f.header=c);f.keys=g;f.indexes=h;b.fb.p.handleEvent.call(this,"change",f)};b.fb.prototype.lK=function(f){var a,d,c;a=[];c=[];for(d=0;d<f.length;d++)a.push({row:f[d].key}),c.push({row:f[d].index,
column:-1});f={source:this,operation:"delete"};f.keys=a;f.indexes=c;b.fb.p.handleEvent.call(this,"change",f)};b.fb.prototype.LU=function(f,a){a.success.call(null,new b.bg(null,f.start))}});