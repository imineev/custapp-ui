/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojdatasource-common"],function(b){b.mb=function(f,a){if(!(f instanceof Array)&&"function"!=typeof f&&"function"!=typeof f.iCa)throw Error("_ERR_DATA_INVALID_TYPE_SUMMARY\n_ERR_DATA_INVALID_TYPE_DETAIL");this.Qu=this.goa(a);null!=a&&(this.columns=a.columns,this.lk=a.initialSort);b.mb.p.constructor.call(this,f)};o_("ArrayDataGridDataSource",b.mb,b);b.b.la(b.mb,b.Dp,"oj.ArrayDataGridDataSource");b.mb.prototype.Init=function(){null==this.columns&&(this.columns=this.$ma(this.Hl()));
this.Iqa();"function"==typeof this.data&&this.data.subscribe(this.Yva.bind(this),null,"arrayChange");b.mb.p.Init.call(this)};b.b.g("ArrayDataGridDataSource.prototype.Init",{Init:b.mb.prototype.Init});b.mb.prototype.goa=function(b){if(null!=b&&null!=b.rowHeader)if(b=b.rowHeader,"object"===typeof b){if(null!=b["default"]&&"none"==b["default"])return}else if(null!=b)return b;return"m_defaultIndex"};b.mb.prototype.Iqa=function(){var b;b=this.Hl();for(this.pu=0;this.pu<b.length;this.pu+=1)b[this.pu].ojKey=
this.pu.toString()};b.mb.prototype.$ma=function(b){var a,d;if("number"!==typeof b.length||0===b.length)return[];d=[];for(a in b[0])b[0].hasOwnProperty(a)&&(void 0!=this.Qu&&a==this.Qu||d.push(a));return d};b.mb.prototype.getCount=function(b){return"row"===b?this.Uq():"column"===b?this.columns.length:0};b.b.g("ArrayDataGridDataSource.prototype.getCount",{getCount:b.mb.prototype.getCount});b.mb.prototype.getCountPrecision=function(){return"exact"};b.b.g("ArrayDataGridDataSource.prototype.getCountPrecision",
{getCountPrecision:b.mb.prototype.getCountPrecision});b.mb.prototype.eP=function(b,a){var d;if("row"===b){if(void 0==this.Qu)return null;if("m_defaultIndex"==this.Qu)return this.xG(a);d=this.Hl();return d[a][this.Qu]}if("column"===b)return this.columns[a]};b.mb.prototype.wna=function(b,a){var d;if("row"===b)return{key:this.xG(a)};if("column"===b)return d=this.eP(b,a),null!=this.lk&&this.lk.key===d?{key:this.eP(b,a),sortDirection:this.lk.direction}:{key:d}};b.mb.prototype.fetchHeaders=function(f,a,
d){var c,e,g,h;c=f.axis;e=f.start;g=f.count;e=Math.max(0,e);"column"===c?g=Math.min(this.columns.length,e+g):(h=this.Hl(),g=void 0===this.Qu?e:Math.min(h.length,e+g));c=new b.Ke(e,g,c,this);null!=a&&null!=a.success&&(null==d&&(d={}),a.success.call(d.success,c,f))};b.b.g("ArrayDataGridDataSource.prototype.fetchHeaders",{fetchHeaders:b.mb.prototype.fetchHeaders});b.mb.prototype.Sma=function(b,a){var d=this.columns[a];return this.Hl()[b][d]};b.mb.prototype.Tma=function(b,a){return{keys:{row:this.xG(b),
column:this.columns[a]}}};b.mb.prototype.fetchCells=function(f,a,d){var c,e,g,h,k,l;for(c=0;c<f.length;c+=1)e=f[c],"row"===e.axis?(g=e.start,h=Math.min(this.Uq(),g+e.count)):"column"===e.axis&&(k=e.start,l=Math.min(this.columns.length,k+e.count));void 0===h||void 0===l?null!=a&&null!=a.error&&(null==d&&(d={}),a.error.call(d.error)):(c=new b.ph(g,h,k,l,this),null!=a&&null!=a.success&&(null==d&&(d={}),a.success.call(d.success,c,f)))};b.b.g("ArrayDataGridDataSource.prototype.fetchCells",{fetchCells:b.mb.prototype.fetchCells});
b.mb.prototype.keys=function(b){var a=b.row,d=b.column;return new Promise(function(b){b({row:this.xG(a),column:this.columns[d]})}.bind(this))};b.b.g("ArrayDataGridDataSource.prototype.keys",{keys:b.mb.prototype.keys});b.mb.prototype.indexes=function(b){var a=b.row,d=b.column;return new Promise(function(b){b({row:this.wG(a),column:this.columns.indexOf(d)})}.bind(this))};b.b.g("ArrayDataGridDataSource.prototype.indexes",{indexes:b.mb.prototype.indexes});b.mb.prototype.sort=function(b,a,d){var c=[],
e=[],g,h;null!=a&&null==d&&(d={});if(null==b)this.cS(a,d);else if(g=b.axis,h=b.key,b=b.direction,"column"===g)void 0==this.Ku&&(this.xsa=this.lk,this.Ku=this.data.slice()),this.lk={key:h,direction:b},this.Hl().sort(this.c6(b,h)),null!=a&&null!=a.success&&a.success.call(d.success);else if("row"===g){h=this.wG(h);for(g=0;g<this.columns.length;g+=1)c[g]=this.Hl()[h][this.columns[g]];c.sort(this.c6(b));for(g=0;g<this.columns.length;g+=1)e[g]=this.columns[c.indexOf(this.Hl()[h][this.columns[g]])];this.Hca=
this.columns;this.columns=e;null!=a&&null!=a.success&&a.success.call(d.success)}else null!==a&&null!=a.error&&a.error.call(d.error,"Invalid axis value")};b.b.g("ArrayDataGridDataSource.prototype.sort",{sort:b.mb.prototype.sort});b.mb.prototype.cS=function(b,a){null!=this.Ku&&(this.data=this.Ku,this.lk=this.xsa);null!=this.Hca&&(this.columns=this.Hca);null!=b&&null!=b.success&&b.success.call(a.success)};b.mb.prototype.getCapability=function(b){return"sort"===b?"column":"move"===b?"row":null};b.b.g("ArrayDataGridDataSource.prototype.getCapability",
{getCapability:b.mb.prototype.getCapability});b.mb.prototype.c6=function(b,a){if("ascending"===b)return function(b,c){var e,f;void 0!=a&&(b instanceof Array?(b=b[parseInt(a,10)],c=c[parseInt(a,10)]):(b=b[a],c=c[a]));e=isNaN(b);f=isNaN(c);b instanceof Date&&(b=b.toISOString(),e=!0);c instanceof Date&&(c=c.toISOString(),f=!0);return e&&f?b<c?-1:b===c?0:1:e?1:f?-1:b-c};if("descending"===b)return function(b,c){var e,f;void 0!=a&&(b instanceof Array?(b=b[parseInt(a,10)],c=c[parseInt(a,10)]):(b=b[a],c=
c[a]));e=isNaN(b);f=isNaN(c);b instanceof Date&&(b=b.toISOString(),e=!0);c instanceof Date&&(c=c.toISOString(),f=!0);return e&&f?b>c?-1:b===c?0:1:e?-1:f?1:c-b}};b.mb.prototype.move=function(b,a){var d,c;d=this.wG(b);c=this.data.splice(d,1)[0];this.data instanceof Array&&(d=this.Cm("delete",b,null,d,-1,!0),this.handleEvent("change",d));null===a?(this.data.push(c),d=this.data.length):(d=this.wG(a),this.data.splice(d,0,c));this.data instanceof Array&&(d=this.Cm("insert",b,null,d,-1),this.handleEvent("change",
d));null!=this.Ku&&(this.Ku=this.data.slice())};b.b.g("ArrayDataGridDataSource.prototype.move",{move:b.mb.prototype.move});b.mb.prototype.moveOK=function(){return"valid"};b.b.g("ArrayDataGridDataSource.prototype.moveOK",{moveOK:b.mb.prototype.moveOK});b.mb.prototype.Hl=function(){return"function"===typeof this.data?this.data():this.data};b.mb.prototype.wG=function(b){var a,d=this.Hl();for(a=0;a<d.length;a++)if(d[a].ojKey===b)return a;return-1};b.mb.prototype.xG=function(b){var a=this.Hl();return a[b]?
a[b].ojKey:null};b.mb.prototype.Cm=function(b,a,d,c,e,g){var h={source:this};h.operation=b;h.keys={row:a,column:d};h.indexes={row:c,column:e};h.silent=g;return h};b.mb.prototype.Yva=function(b){var a,d,c,e=!1;d=!1;var g=[],h=[];for(a=0;a<b.length;a++){c=b[a];if(void 0!==c.moved){d=!0;c=this.Cm("refresh",null,null);this.handleEvent("change",c);break}"added"===c.status&&(e=!0)}if(!d){for(a=0;a<b.length;a++)c=b[a],"deleted"===c.status&&(d=c.value,c=c.index,d=d.ojKey,g.push({row:d,column:-1}),h.push({row:c,
column:-1}));0<g.length&&(c={source:this,operation:"delete",keys:g,indexes:h,silent:e},this.handleEvent("change",c));for(a=0;a<b.length;a++)c=b[a],"added"===c.status&&(d=c.value,c=c.index,null==d.ojKey&&(d.ojKey=this.pu.toString(),this.pu++),d=d.ojKey,c=this.Cm("insert",d,null,c,-1),this.handleEvent("change",c))}null!=this.Ku&&(this.Ku=this.data.slice())};b.mb.prototype.Uq=function(){return this.Hl().length};b.mb.prototype.Daa=function(){return this.Qu};b.b.g("ArrayDataGridDataSource.prototype.getRowHeaderKey",
{Daa:b.mb.prototype.Daa});b.mb.prototype.mr=function(){return this.columns};b.b.g("ArrayDataGridDataSource.prototype.getColumns",{mr:b.mb.prototype.mr});b.mb.prototype.getData=function(){return this.data};b.b.g("ArrayDataGridDataSource.prototype.getData",{getData:b.mb.prototype.getData});b.Ke=function(b,a,d,c){this.Gc=b;this.zf=a;this.Yba=d;this.Jl=c};o_("ArrayHeaderSet",b.Ke,b);b.Ke.prototype.getData=function(f,a){if(null==this.Jl)return null;b.l.assert(f<=this.zf&&f>=this.Gc,"index out of bounds");
b.l.assert(null==a||0==a,"level out of bounds");return this.Jl.eP(this.Yba,f)};b.b.g("ArrayHeaderSet.prototype.getData",{getData:b.Ke.prototype.getData});b.Ke.prototype.getMetadata=function(f,a){if(null==this.Jl)return null;b.l.assert(f<=this.zf&&f>=this.Gc,"index out of bounds");b.l.assert(null==a||0==a,"level out of bounds");return this.Jl.wna(this.Yba,f)};b.b.g("ArrayHeaderSet.prototype.getMetadata",{getMetadata:b.Ke.prototype.getMetadata});b.Ke.prototype.getLevelCount=function(){return 0<this.getCount()?
1:0};b.b.g("ArrayHeaderSet.prototype.getLevelCount",{getLevelCount:b.Ke.prototype.getLevelCount});b.Ke.prototype.getExtent=function(f,a){b.l.assert(f<=this.zf&&f>=this.Gc,"index out of bounds");b.l.assert(null==a||0==a,"level out of bounds");return{extent:1,more:{before:!1,after:!1}}};b.b.g("ArrayHeaderSet.prototype.getExtent",{getExtent:b.Ke.prototype.getExtent});b.Ke.prototype.getDepth=function(f,a){b.l.assert(f<=this.zf&&f>=this.Gc,"index out of bounds");b.l.assert(null==a||0==a,"level out of bounds");
return 1};b.b.g("ArrayHeaderSet.prototype.getDepth",{getDepth:b.Ke.prototype.getDepth});b.Ke.prototype.getCount=function(){return null==this.Jl?0:Math.max(0,this.zf-this.Gc)};b.b.g("ArrayHeaderSet.prototype.getCount",{getCount:b.Ke.prototype.getCount});b.Ke.prototype.getStart=function(){return this.Gc};b.b.g("ArrayHeaderSet.prototype.getStart",{getStart:b.Ke.prototype.getStart});b.ph=function(b,a,d,c,e){this.sa=b;this.Ya=a;this.xn=d;this.vu=c;this.Jl=e};o_("ArrayCellSet",b.ph,b);b.ph.prototype.getData=
function(b){return this.Jl.Sma(b.row,b.column)};b.b.g("ArrayCellSet.prototype.getData",{getData:b.ph.prototype.getData});b.ph.prototype.getMetadata=function(b){return this.Jl.Tma(b.row,b.column)};b.b.g("ArrayCellSet.prototype.getMetadata",{getMetadata:b.ph.prototype.getMetadata});b.ph.prototype.getStart=function(b){return"row"==b?this.sa:"column"==b?this.xn:-1};b.b.g("ArrayCellSet.prototype.getStart",{getStart:b.ph.prototype.getStart});b.ph.prototype.getCount=function(b){return"row"===b?Math.max(0,
this.Ya-this.sa):"column"===b?Math.max(0,this.vu-this.xn):0};b.b.g("ArrayCellSet.prototype.getCount",{getCount:b.ph.prototype.getCount});b.ph.prototype.jn=function(){return this.sa};b.b.g("ArrayCellSet.prototype.getStartRow",{jn:b.ph.prototype.jn});b.ph.prototype.hn=function(){return this.xn};b.b.g("ArrayCellSet.prototype.getStartColumn",{hn:b.ph.prototype.hn})});