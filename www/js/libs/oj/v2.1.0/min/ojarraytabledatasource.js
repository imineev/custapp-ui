/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","ojs/ojdatasource-common"],function(b,f){b.Qa=function(a,d){this.data={};if(!(a instanceof Array)&&"function"!=typeof a&&"function"!=typeof a.iCa)throw Error(b.V.Kc._ERR_DATA_INVALID_TYPE_SUMMARY+"\n"+b.V.Kc._ERR_DATA_INVALID_TYPE_DETAIL);null!=d&&null!=d.idAttribute||b.r.info(b.Qa.Kc._INFO_ARRAY_TABLE_DATASOURCE_IDATTR);b.Qa.p.constructor.call(this,a,d);this.ie=[];this.ua={};if(null!=a&&void 0!==a&&(this.FQ=null,null!=d&&null!=d.idAttribute&&(this.FQ=d.idAttribute),
this.i=a instanceof Array?a:a(),this.rf=this.i.length,!(a instanceof Array))){var c=this;a.subscribe(function(a){if(c.d5()){var b,d=[],f=[];for(b=0;b<a.length;b++)"deleted"===a[b].status&&d.push(a[b].value);c.remove(d,null);d=[];f=[];for(b=0;b<a.length;b++)"added"===a[b].status&&(d.push(a[b].value),f.push(a[b].index));c.add(d,{at:f})}},null,"arrayChange")}if(null!=d&&("enabled"==d.startFetch||null==d.startFetch)||null==d)this.PB=!0};o_("ArrayTableDataSource",b.Qa,b);b.b.la(b.Qa,b.V,"oj.ArrayTableDataSource");
b.Qa.prototype.Init=function(){b.Qa.p.Init.call(this)};b.b.g("ArrayTableDataSource.prototype.Init",{Init:b.Qa.prototype.Init});b.Qa.prototype.add=function(a,b){b=b||{};this.Ls();return this.Gia(a,b.at,b)};b.b.g("ArrayTableDataSource.prototype.add",{add:b.Qa.prototype.add});b.Qa.prototype.at=function(a){this.Ls();var b;b=0>a||a>=this.ua.data.length?null:{data:this.ua.data[a],index:a,key:this.tw(this.ua.data[a])};return new Promise(function(a){a(b)})};b.b.g("ArrayTableDataSource.prototype.at",{at:b.Qa.prototype.at});
b.Qa.prototype.change=function(a,d){d=d||{};this.Ls();var c=d.silent,e,f,h,k,l={data:[],keys:[],indexes:[]};a instanceof Array||(a=[a]);for(e=0;e<a.length;e++)f=a[e],null!=f&&(h=this.tw(f),k=this.jj(h,null),l.data.push(f),l.keys.push(h),l.indexes.push(k.index),this.ua.data[k.index]=f);!c&&0<l.data.length&&b.V.p.handleEvent.call(this,b.V.N.CHANGE,l);return Promise.resolve(l)};b.b.g("ArrayTableDataSource.prototype.change",{change:b.Qa.prototype.change});b.Qa.prototype.fetch=function(a){a=a||{};return"init"!=
a.fetchType||this.PB?this.Lf(a):Promise.resolve()};b.b.g("ArrayTableDataSource.prototype.fetch",{fetch:b.Qa.prototype.fetch});b.Qa.prototype.get=function(a,b){b=b||{};this.Ls();return Promise.resolve(this.jj(a,b))};b.b.g("ArrayTableDataSource.prototype.get",{get:b.Qa.prototype.get});b.Qa.prototype.getCapability=function(){return"full"};b.b.g("ArrayTableDataSource.prototype.getCapability",{getCapability:b.Qa.prototype.getCapability});b.Qa.prototype.remove=function(a,b){b=b||{};this.Ls();return this.Kt(a,
b)};b.b.g("ArrayTableDataSource.prototype.remove",{remove:b.Qa.prototype.remove});b.Qa.prototype.reset=function(a,d){d=d||{};d.previousRows=this.ua;var c=d.silent;null!=a&&(this.i=a);this.ua={};this.rf=0;c||b.V.p.handleEvent.call(this,b.V.N.RESET,null);return Promise.resolve()};b.b.g("ArrayTableDataSource.prototype.reset",{reset:b.Qa.prototype.reset});b.Qa.prototype.sort=function(a){if(null==a)return this.comparator=null,Promise.resolve();this.Ls();var d=a.key,c=a.direction,e=null;"ascending"==c?
e=function(a){return f.isFunction(a[d])?a[d]():a[d]}:"descending"==c&&(e=function(a,b){var c,e;f.isFunction(a[d])?(c=a[d](),e=b[d]()):(c=a[d],e=b[d]);return c===e?0:c>e?-1:1});this.comparator=e;this.direction=c;var g=this;return new Promise(function(c){a=a||{};if(g.IG()){var d=g.comparator;g.ua.data.sort(function(a,c){return b.Qa.O8(a,c,d,g)});g.Tva=!0;var e={header:a.key,direction:a.direction};b.V.p.handleEvent.call(g,b.V.N.SORT,e);c(e)}})};b.b.g("ArrayTableDataSource.prototype.sort",{sort:b.Qa.prototype.sort});
b.Qa.prototype.totalSize=function(){return this.rf};b.b.g("ArrayTableDataSource.prototype.totalSize",{totalSize:b.Qa.prototype.totalSize});b.Qa.prototype.Gia=function(a,d,c){var e,f;c=c||{};var h=c.silent,k={data:[],keys:[],indexes:[]};a instanceof Array||(a=[a]);null==d||d instanceof Array||(d=[d]);for(c=0;c<a.length;c++)if(f=a[c],null!=f){e=this.tw(f);k.data.push(f);k.keys.push(e);if(!0==this.Tva&&0<this.ua.data.length)for(e=0;e<this.ua.data.length;e++)if(0>b.Qa.O8(f,this.ua.data[e],this.comparator,
this)){this.ua.data.splice(e,0,f);k.indexes.push(e);break}else{if(e==this.ua.data.length-1){this.ua.data.push(f);k.indexes.push(e+1);break}}else null==d?(this.ua.data.push(f),k.indexes.push(this.ua.data.length-1)):(this.ua.data.splice(d[c],0,f),k.indexes.push(d[c]));this.rf++;this.xB()}!h&&0<k.data.length&&b.V.p.handleEvent.call(this,b.V.N.ADD,k);return Promise.resolve(k)};b.Qa.prototype.Ls=function(){this.d5()||(this.ua=this.zw(this.i),this.rf=this.i.length)};b.Qa.prototype.d5=function(){return null==
this.ua||null==this.ua.data?!1:!0};b.Qa.prototype.Lf=function(a){a=a||{};this.OB(a);this.Ls();var d;try{d=0<a.pageSize?a.pageSize:-1;this.fa||(this.fa=0);this.fa=null==a.startIndex?this.fa:a.startIndex;var c=b.Qa.iG(this.ua,this.fa,d),e=[],f=[],h;for(h=this.fa;h<=c;h++)e[h-this.fa]=this.ua.data[h],f[h-this.fa]=this.tw(this.ua.data[h])}catch(k){return this.dl(a,null,k),Promise.reject(k)}c<this.fa&&(this.fa=c+1);a.pageSize=d;a.startIndex=this.fa;a.refresh=!0;d={data:e,keys:f,startIndex:this.fa};this.dl(a,
d,null);return Promise.resolve(d)};b.Qa.prototype.jj=function(a){var b,c,e,g,h=null;for(b=0;b<this.ua.data.length;b++)if(e=this.ua.data[b],void 0!==e)if(g=this.tw(e),f.isArray(g)&&f.isArray(a)){if(g.length==a.length){var k=!0;for(c=0;c<a.length;c++)if(g[c]!=a[c]){k=!1;break}k&&(h={data:e,key:g,index:this.ua.indexes[b]})}}else g==a&&(h={data:e,key:g,index:this.ua.indexes[b]});return h};b.Qa.prototype.IG=function(){var a=this.comparator;return void 0!==a&&null!==a};b.Qa.prototype.xB=function(){for(var a=
0;a<this.ua.data.length;a++)this.ua.indexes[a]=a};b.Qa.prototype.Kt=function(a,d){var c,e;d=d||{};var f=d.silent,h={data:[],keys:[],indexes:[]};a instanceof Array||(a=[a]);var k=[];for(c=0;c<a.length;c++)e=a[c],null!=e&&(e=this.tw(e),e=this.jj(e,null),null!=e&&k.push({data:e.data,key:e.key,index:e.index}));k.sort(function(a,b){return a.index-b.index});for(c=0;c<k.length;c++)h.data.push(k[c].data),h.keys.push(k[c].key),h.indexes.push(k[c].index);for(c=h.indexes.length-1;0<=c;c--)this.ua.data.splice(h.indexes[c],
1),this.ua.indexes.splice(h.indexes[c],1),this.rf--,this.xB();!f&&0<h.data.length&&b.V.p.handleEvent.call(this,b.V.N.REMOVE,h);return Promise.resolve(h)};b.Qa.prototype.OB=function(a){a.silent||b.V.p.handleEvent.call(this,b.V.N.REQUEST,{startIndex:a.startIndex})};b.Qa.prototype.dl=function(a,d,c){null!=c?b.V.p.handleEvent.call(this,b.V.N.ERROR,c):a.silent||b.V.p.handleEvent.call(this,b.V.N.SYNC,d)};b.Qa.Wn=function(a,b,c){if("descending"==c){if(a<b)return 1;if(b<a)return-1}else{if(a>b)return 1;if(b>
a)return-1}return 0};b.Qa.iG=function(a,b,c){var e=a.data.length-1;0<c&&(e=b+c-1,e=e>a.data.length-1?a.data.length-1:e);return e};b.Qa.Ab=function(a,b){return f.isFunction(a[b])?a[b]():a[b]};b.Qa.prototype.zw=function(a){var b=a.length-1,c={},e,f;c.data=[];c.indexes=[];this.gq=null;for(e=0;e<=b;e++){var h={},k=a[e];for(f in k)k.hasOwnProperty(f)&&(h[f]=k[f],0==e&&(null==this.gq&&(this.gq=[]),this.gq.push(f)));c.data[e]=h;c.indexes[e]=e}return c};b.Qa.prototype.tw=function(a){var d,c=this.gP(a);if(f.isArray(c)){var e;
d=[];for(e=0;e<c.length;e++)if(c[e]in a)d[e]=a[c[e]];else throw a=b.na.oc(b.Qa.Kc._ERR_ARRAY_TABLE_DATASOURCE_IDATTR_NOT_IN_ROW,[c[e]]),Error(a);}else if(c in a)d=a[c];else throw a=b.na.oc(b.Qa.Kc._ERR_ARRAY_TABLE_DATASOURCE_IDATTR_NOT_IN_ROW,[c]),Error(a);return d};b.Qa.prototype.gP=function(a){if(null!=this.FQ)return this.FQ;if(null==this.gq){this.gq=[];for(var b in a)a.hasOwnProperty(b)&&this.gq.push(b)}return this.gq.hasOwnProperty("id")?"id":this.gq};b.Qa.O8=function(a,d,c,e){var g,h;if(f.isFunction(c)){if(1===
c.length){g=c.call(e,a);h=c.call(e,d);a=b.Ra.oe(g)?g.split(","):[g];d=b.Ra.oe(h)?h.split(","):[h];for(c=0;c<a.length;c++)if(g=b.Qa.Wn(a[c],d[c],e.direction),0!==g)return g;return 0}return c.call(e,a,d)}if(b.Ra.oe(c)){var k=c.split(",");for(c=0;c<k.length;c++)if(g=b.Qa.Ab(a,k[c]),h=b.Qa.Ab(d,k[c]),g=b.Qa.Wn(g,h,e.direction),0!==g)return g}return 0};b.Qa.Kc={_INFO_ARRAY_TABLE_DATASOURCE_IDATTR:"idAttribute option has not been specified. Will default to using 'id' if the field exists. If not, will use all the fields.",
_ERR_ARRAY_TABLE_DATASOURCE_IDATTR_NOT_IN_ROW:"Specified idAttribute {0} not in row data. Please ensure all specified idAttribute fields are in the row data or do not specify idAttribute and all fields will be used as id."}});