/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojpopupcore"],function(b,f){(function(){b.Ja("oj.ojMenu",f.oj.baseComponent,{defaultElement:"\x3cul\x3e",delay:300,role:"menu",widgetEventPrefix:"oj",options:{menuSelector:"ul",openOptions:{initialFocus:"menu",launcher:null,position:{my:"start top",at:"start bottom",collision:"flipfit"}},submenuOpenOptions:{position:{my:"start top",at:"end top",collision:"flipfit"}},beforeOpen:null,close:null,open:null,select:null},_ComponentCreate:function(){this._super();
this._focusForTesting=this.Ih;this._nextForTesting=this.f6;this._selectForTesting=this.wl;this.Wt=this.element;this.HV=!1;this.element.uniqueId().addClass("oj-menu oj-component").hide().attr({role:this.role,tabIndex:"0"});this._on(!0,{"mousedown .oj-menu-item":function(a){this.options.disabled&&a.preventDefault()},click:function(a){this.options.disabled&&a.preventDefault()},keydown:function(a){!this.options.disabled||a.keyCode!==f.ui.keyCode.ESCAPE&&a.keyCode!==f.ui.keyCode.TAB||(a.keyCode===f.ui.keyCode.TAB&&
a.preventDefault(),this.Qc&&this.UF(a))}});this.options.disabled&&this.element.addClass("oj-disabled").attr("aria-disabled","true");var a=function(a){if(!this.gU){this.gU=!0;var b=f(a.currentTarget);b.siblings().removeClass("oj-focus-ancestor");this.Ih(a,b)}}.bind(this);this._on({"mousedown .oj-menu-item \x3e a":function(a){a.preventDefault()},"click .oj-disabled \x3e a":function(a){a.preventDefault()},click:function(){this.HV=!1},touchstart:function(){this.gU=!1},mouseover:function(){this.gU=!1},
"click .oj-menu-item:has(a)":function(a){var b=f(a.target).closest(".oj-menu-item");!this.HV&&b.not(".oj-disabled").length&&(this.HV=!0,a.preventDefault(),this.Pa&&this.Pa.closest(b).length&&this.Pa.get(0)!=b.get(0)||(b.has(".oj-menu").length?this.ff(a):(this.wl(a),this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.Pa&&1===this.Pa.parents(".oj-menu").length&&clearTimeout(this.$d)))))},"mouseenter .oj-menu-item":a,"touchstart .oj-menu-item":a,mouseleave:function(a){this.wm(a,"eventSubtree")},
"mouseleave .oj-menu":function(a){this.wm(a,"eventSubtree")},focus:function(a,b){if(!b){var c=this.Pa||this.element.children(".oj-menu-item").eq(0);this.Ih(a,c)}},keydown:this.At,keyup:function(a){if(a.keyCode==f.ui.keyCode.ENTER||a.keyCode==f.ui.keyCode.SPACE)this.PE=!1}});this.bC=f.proxy(this.cC,this);this.Ma()},Rv:function(a){if(arguments.length)d=a;else return d},GN:function(b){if(("focus"===b.type||"mousedown"===b.type||"touchstart"===b.type||93==b.which||121==b.which&&b.shiftKey||93==b.keyCode)&&
("mousedown"!==b.type||!d)){var e=a.slice(0,a.length);f.each(e,function(a,d){!f(b.target).closest(d.element).length&&("keydown"===b.type||"mousedown"===b.type&&3===b.which||!f(b.target).closest(d.Qc).length||d.yra&&("mousedown"===b.type&&3!==b.which||"touchstart"===b.type))&&(d.wm(b,"eventSubtree"),d.Qc&&d.Gs(b))})}},_setOption:function(a,d){this._superApply(arguments);this.Qc||("submenuOpenOptions"===a?this.$H=b.ad.$h(d.position,this.jh):"submenuOpenOptions.position"===a&&(this.$H=b.ad.$h(d,this.jh)))},
_destroy:function(){this.element.is(":visible")&&this.Gs();clearTimeout(this.$d);delete this.$d;this.element.removeAttr("aria-activedescendant").removeClass("oj-component").find(".oj-menu").addBack().removeClass("oj-menu oj-menu-submenu oj-menu-icons oj-menu-text-only").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show();this.element.find(".oj-menu-item").removeClass("oj-menu-item").removeAttr("role").children("a").removeAttr("aria-disabled").removeUniqueId().removeClass("oj-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var a=
f(this);a.data("oj-ojMenu-submenu-icon")&&a.remove()});this.element.find("a").removeAttr("aria-expanded");this.element.find(".oj-menu-divider").removeClass("oj-menu-divider").removeAttr("role");0<=a.indexOf(this)&&a.splice(a.indexOf(this),1);delete this.tl;delete this.bC;var b=this.kq;isNaN(b)||(delete this.kq,window.clearTimeout(b));this._super()},At:function(a){function b(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$\x26")}var d,h,k,l,p=!0;switch(a.keyCode){case f.ui.keyCode.HOME:this.lH("first",
"first",a);break;case f.ui.keyCode.END:this.lH("last","last",a);break;case f.ui.keyCode.UP:this.Tsa(a);break;case f.ui.keyCode.DOWN:this.f6(a);break;case f.ui.keyCode.LEFT:case f.ui.keyCode.RIGHT:a.keyCode===f.ui.keyCode.RIGHT^this.jh?this.Pa&&!this.Pa.is(".oj-disabled")&&this.ff(a):this.wm(a,"active");break;case f.ui.keyCode.ENTER:case f.ui.keyCode.SPACE:this.Yoa(a);this.PE=!0;var n=this;setTimeout(function(){n.PE=!1},100);break;case f.ui.keyCode.TAB:a.preventDefault();this.Qc&&this.UF(a);break;
case f.ui.keyCode.ESCAPE:this.Qc?(h=this.element.attr("aria-activedescendant"),k="#"+this.element.attr("id")+"\x3e*\x3ea",h&&!f("#"+h).is(k)?this.wm(a,"active"):this.UF(a)):this.wm(a,"active");break;default:p=!1,d=this.fK||"",h=String.fromCharCode(a.keyCode),k=!1,clearTimeout(this.Iya),h===d?k=!0:h=d+h,l=new RegExp("^"+b(h),"i"),d=this.Wt.children(".oj-menu-item").filter(function(){return l.test(f(this).children("a").text())}),d=k&&-1!==d.index(this.Pa.next())?this.Pa.nextAll(".oj-menu-item"):d,d.length||
(h=String.fromCharCode(a.keyCode),l=new RegExp("^"+b(h),"i"),d=this.Wt.children(".oj-menu-item").filter(function(){return l.test(f(this).children("a").text())})),d.length?(this.Ih(a,d),1<d.length?(this.fK=h,this.Iya=this._delay(function(){delete this.fK},1E3)):delete this.fK):delete this.fK}p&&a.preventDefault()},Yoa:function(a){this.Pa&&!this.Pa.is(".oj-disabled")&&(this.Pa.children("a[aria-haspopup\x3d'true']").length?this.ff(a):this.wl(a))},refresh:function(){this._super();this.Ma();var a=this.element;
if(a.is(":visible")){var b=a.data("oj-menu-position");b&&a.position(b);a.find(".oj-menu").each(function(){var a=f(this);a.is(":visible")&&(b=a.data("oj-menu-position"))&&a.position(b)})}},Ma:function(){this.jh="rtl"===this.Ic();this.$H=b.ad.$h(this.options.submenuOpenOptions.position,this.jh);var a=this,d=this.element.find(this.options.menuSelector),g=d.add(this.element),h=g.children();h.filter(".oj-menu-divider").has("a").removeClass("oj-menu-divider oj-menu-item").removeAttr("role");h.filter(":not(.oj-menu-item):has(a)").addClass("oj-menu-item").attr("role",
"presentation").children("a").uniqueId().attr({tabIndex:"-1",role:"menuitem"});h.filter(":not(.oj-menu-item)").each(function(){var a=f(this);/[^\-\u2014\u2013\s]/.test(a.text())||a.addClass("oj-menu-divider").attr("role","separator")});h.filter(".oj-disabled").children("a").attr("aria-disabled","true");h.filter(":not(.oj-disabled)").children("a").removeAttr("aria-disabled");d.filter(":not(.oj-menu)").addClass("oj-menu oj-menu-submenu").hide().attr({role:this.role,"aria-hidden":"true"}).each(function(){var b=
f(this),d=a.GP(b),e=f("\x3cspan\x3e");e.addClass("oj-menu-submenu-icon oj-component-icon").data("oj-ojMenu-submenu-icon",!0);d.attr("aria-haspopup","true").attr("aria-expanded","false").append(e);d=d.attr("id");b.attr("aria-labelledby",d)});g.each(function(){var a=f(this),b=a.children().children().children(".oj-menu-item-icon").length;a.toggleClass("oj-menu-icons",!!b).toggleClass("oj-menu-text-only",!b)});this.Pa&&!f.contains(this.element[0],this.Pa[0])&&this.dN()},GP:function(a){return a.prev("a")},
KDa:function(){return"menuitem"},QE:function(a){return a.add(a.prev(".oj-menu-divider")).add(a.next(".oj-menu-divider"))},Ih:function(a,b){a&&"focus"===a.type||clearTimeout(this.$d);b=b.first();this.P5(b,a);var d=b.parent().closest(".oj-menu-item");this.QE(d).addClass("oj-focus-ancestor");a&&"keydown"===a.type?this.Vn():this.$d=this._delay(function(){delete this.$d;this.Vn()},this.delay);d=b.children(".oj-menu");d.length&&a&&/^mouse/.test(a.type)&&!this.Pa.hasClass("oj-disabled")&&this.Uva(d);this.Wt=
b.parent()},P5:function(a,b){if(!a.is(this.Pa)){var d=this.Pa?this.Pa:f(),h=a.children("a");this.Pa=a;this.element.attr("aria-activedescendant",h.attr("id"));this.QE(d).removeClass("oj-focus");this.QE(a).addClass("oj-focus");this._trigger("_activeItem",b,{previousItem:d,item:a,privateNotice:"The _activeItem event is private.  Do not use."})}},Gta:function(a){if(this.Pa){var b=this.Pa;this.Pa=null;this.element.removeAttr("aria-activedescendant");this.QE(b).removeClass("oj-focus");this._trigger("_activeItem",
a,{previousItem:b,item:f(),privateNotice:"The _activeItem event is private.  Do not use."})}},dN:function(a){clearTimeout(this.$d);this.Gta(a)},UF:function(a,b){this.Qc.focus();this.Gs(a,b)},Gs:function(c,d){var f=this.element.is(":visible"),h={};h[b.R.kb.zg]=this.element;b.R.wf().close(h);this.element.removeData("oj-menu-position");this.Qc=void 0;d&&(c=this.bT("select",c,d).event);f&&this._trigger("close",c,{});this.pq=null;0<=a.indexOf(this)&&a.splice(a.indexOf(this),1)},getCurrentOpenOptions:function(){return f.extend(!0,
{},this.pq||this.options.openOptions)},open:function(c,d,g){d=f.extend({},this.options.openOptions,d);d.position=f.extend({},d.position);g=f.extend({},this.options.submenuOpenOptions,g);var h=this.pq;this.pq=d;b.ad.rsa(c);this.yra=this.OE;var k=!this.bT("beforeOpen",c,{openOptions:d});if(k.proceed)this.pq=h;else if(this.element.is(":visible")&&(this.pq=h,this.Gs(k.event),this.pq=d),h=d.launcher,(h="string"===f.type(h)?f(h):h)&&h.length)if(k=b.ad.$h(d.position,this.jh),k.of=b.ad.gBa(k.of,h,c),null==
k.of)b.r.warn("position.of passed to Menu.open() is 'event', but the event is null.  Ignoring the call."),this.pq=null;else{var l=this.element[0],p=a.slice(0,a.length);f.each(p,function(a,b){b.element[0]!==l&&(b.wm(c,"eventSubtree"),b.Qc&&b.Gs(c))});this.$H=b.ad.$h(g.position,this.jh);g=this.bC;f.isFunction(k.using)&&k.using!==g&&(k.origUsing=k.using);k.using=g;g={};g[b.R.kb.zg]=this.element;g[b.R.kb.Qy]=h;g[b.R.kb.Ty]=k;g[b.R.kb.Zr]=this.xw();g[b.R.kb.Hp]="oj-menu-layer";b.R.wf().open(g);this.element.data("oj-menu-position",
k);d=d.initialFocus;((g="firstItem"===d)||"menu"===d)&&this.element.focus();g?this.Ih(c,this.element.children().first()):this.dN(c);this.Qc=h;a.push(this);this._trigger("open",c,{})}else b.r.warn("When calling Menu.open(), must specify openOptions.launcher via the component option, method param, or beforeOpen listener.  Ignoring the call."),this.pq=null},Uva:function(a){clearTimeout(this.$d);"true"===a.attr("aria-hidden")&&(this.$d&&clearTimeout(this.$d),this.$d=this._delay(function(){delete this.$d;
this.Vn();this.m6(a)},this.delay))},m6:function(b){var d=f.extend({of:this.Pa},this.$H);clearTimeout(this.$d);this.element.find(".oj-menu").not(b.parents(".oj-menu")).hide().attr("aria-hidden","true").removeData("oj-menu-position");b.show().removeAttr("aria-hidden").position(d).data("oj-menu-position",d);this.GP(b).attr("aria-expanded","true");!this.Qc&&0>a.indexOf(this)&&a.push(this)},LM:function(a,b,d){function h(){delete k.$d;var d=b?k.element:f(a&&a.target).closest(k.element.find(".oj-menu"));
d.length||(d=k.element);k.Vn(d);k.dN(a);k.Wt=d}clearTimeout(this.$d);var k=this;d?this.$d=this._delay(h,d):h()},Vn:function(b){b||(b=this.Pa?this.Pa.parent():this.element);var d=b.find(".oj-menu");d.hide().attr("aria-hidden","true").removeData("oj-menu-position");this.GP(d).attr("aria-expanded","false");b.find("oj-focus-ancestor").removeClass("oj-focus-ancestor");this.Qc||0<=a.indexOf(this)&&b===this.element&&a.splice(a.indexOf(this),1)},wm:function(a,d){if(null==d||"active"===d){var f=this.Wt&&this.Wt.closest(".oj-menu-item",
this.element);f&&f.length&&(this.Vn(),this.Ih(a,f))}else"all"===d||"eventSubtree"===d?this.LM(a,"all"===d,this.delay):b.r.warn("Invalid param "+d+" passed to Menu._collapse().  Ignoring the call.")},ff:function(a){var b=this.Pa&&this.Pa.children(".oj-menu ").children(".oj-menu-item").first();b&&b.length&&(this.m6(b.parent()),this.$d&&clearTimeout(this.$d),this.$d=this._delay(function(){delete this.$d;this.Ih(a,b)}))},f6:function(a){this.lH("next","first",a)},Tsa:function(a){this.lH("prev","last",
a)},GDa:function(){return this.Pa&&!this.Pa.prevAll(".oj-menu-item").length},HDa:function(){return this.Pa&&!this.Pa.nextAll(".oj-menu-item").length},lH:function(a,b,d){var f;this.Pa&&(f="first"===a||"last"===a?this.Pa["first"===a?"prevAll":"nextAll"](".oj-menu-item").eq(-1):this.Pa[a+"All"](".oj-menu-item").eq(0));f&&f.length&&this.Pa||(f=this.Wt.children(".oj-menu-item")[b]());this.Ih(d,f)},wl:function(a){if(!this.Pa&&a&&a.target){var d=f(a.target).closest(".oj-menu-item");d.closest(this.element).length&&
this.P5(d,a)}this.Pa?this.Pa.has(".oj-menu").length||this.Pa.is(".oj-disabled")?b.r.warn("Selecting a disabled menu item or parent menu item is not allowed."):(d={item:this.Pa},this.LM(a,!0),this.Qc&&this.UF(a,d)):b.r.warn("Menu._select() called when no menu item is focused and no menu item can be inferred from event param.")},Rt:function(){this.element.remove()},xw:function(){if(!this.tl){var a=this.tl={};a[b.R.md.lv]=f.proxy(this.s0,this);a[b.R.md.mv]=f.proxy(this.Rt,this);a[b.R.md.Kp]=f.proxy(this.refresh,
this);a[b.R.md.kv]=f.proxy(this.GN,this)}return this.tl},s0:function(){this.Vn(this.element);this.Gs(null)},cC:function(a,d){var g=d.element.element;g.css(a);(g=g.data("oj-menu-position"))&&(g=g.origUsing)&&g(a,d);b.ad.SU(d)&&(this.kq=this._delay(f.proxy(this.s0,this),1))}});var a=[],d=!1})()});